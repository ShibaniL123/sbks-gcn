SYSTEM AND METHOD FOR DETERMINING SLEEP STAGE 1 Cross Reference to Related Applications [0001] This application claims the benefit of the filing date of Irish Preliminary Patent Application No. 2012/0409 filed September 19, 2012, the disclosure of which is hereby incorporated herein by reference. 2 BACKGROUND OF THE TECHNOLOGY 2.1 FIELD OF THE TECHNOLOGY [0002] The present technology relates to the determining of sleep stage of humans such as using respiration and movement signals and may be useful, for example, in the assessment of sleep architecture or the quality of sleep. The technology may be implemented in conjunction with devices for the diagnosis, treatment and amelioration of respiratory disorders, and to procedures to prevent respiratory disorders. Thus, the present technology may relate to medical devices, and their use for treating respiratory disorders and for preventing respiratory disorders. 2.2 DESCRIPTION OF THE RELATED ART [0003] The respiratory system of the body facilitates gas exchange. The nose and mouth form the entrance to the airways of a patient. [0004] The airways include a series of branching tubes, which become narrower, shorter and more numerous as they penetrate deeper into the lung. The prime function of the lung is gas exchange, allowing oxygen to move from the air into the venous blood and carbon dioxide to move out. The trachea divides into right and left main bronchi, which further divide eventually into terminal bronchioles. The bronchi make up the conducting airways, and do not take part in gas exchange. Further divisions of the airways lead to the respiratory bronchioles, and eventually to the alveoli. The alveolated region of the lung is where the gas exchange takes place, and is referred to as the respiratory zone. See West, Respiratory Physiology- the essentials. [0005] A range of respiratory disorders exist. [0006] Obstmctive Sleep Apnea (OSA), a form of Sleep Disordered Breathing (SDB), is characterized by occlusion or obstmction of the upper air passage during sleep. It results from a combination of an abnormally small upper airway and the normal loss of muscle tone in the region of the tongue, soft palate and posterior oropharyngeal wall during sleep. The condition causes the affected patient to stop breathing for periods typically of 30 to 120 seconds duration, sometimes 200 to 300 times per night. It often causes excessive daytime somnolence, and it may cause cardiovascular disease and brain damage. The syndrome is a common disorder, particularly in middle aged overweight males, although a person affected may have no awareness of the problem. See US Patent 4,944,310 (Sullivan). [0007] Cheyne-Stokes Respiration (CSR) is a disorder of a patient's respiratory controller in which there are rhythmic alternating periods of waxing and waning ventilation, causing repetitive de-oxygenation and re-oxygenation of the arterial blood. It is possible that CSR is harmful because of the repetitive hypoxia. In some patients CSR is associated with repetitive arousal from sleep, which causes severe sleep dismption, increased sympathetic activity, and increased afterload. See US Patent 6,532,959 (Berthon-Jones). [0008] Obesity Hyperventilation Syndrome (OHS) is defined as the combination of severe obesity and awake chronic hypercapnia, in the absence of other known causes for hypoventilation. Symptoms include dyspnea, morning headache and excessive daytime sleepiness. [0009] Chronic Obstructive Pulmonary Disease (COPD) encompasses any of a group of lower airway diseases that have certain characteristics in common. These include increased resistance to air movement, extended expiratory phase of respiration, and loss of the normal elasticity of the lung. Examples of COPD are emphysema and chronic bronchitis. COPD is caused by chronic tobacco smoking (primary risk factor), occupational exposures, air pollution and genetic factors. Symptoms include: dyspnea on exertion, chronic cough and sputum production. [0010] Neuromuscular Disease (NMD) is a broad term that encompasses many diseases and ailments that impair the functioning of the muscles either directly via intrinsic muscle pathology, or indirectly via nerve pathology. Some NMD patients are characterised by progressive muscular impairment leading to loss of ambulation, being wheelchair-bound, swallowing difficulties, respiratory muscle weakness and, eventually, death from respiratory failure. Neuromuscular disorders can be divided into rapidly progressive and slowly progressive: (i) Rapidly progressive disorders: Characterised by muscle impairment that worsens over months and results in death within a few years (e.g. Amyotrophic lateral sclerosis (ALS) and Duchenne muscular dystrophy (DMD) in teenagers); (ii) Variable or slowly progressive disorders: Characterised by muscle impairment that worsens over years and only mildly reduces life expectancy (e.g. Limb girdle, Facioscapulohumeral and Myotonic muscular dystrophy). Symptoms of respiratory failure in NMD include: increasing generalised weakness, dysphagia, dyspnea on exertion and at rest, fatigue, sleepiness, morning headache, and difficulties with concentration and mood changes. [0011] Chest wall disorders are a group of thoracic deformities that result in inefficient coupling between the respiratory muscles and the thoracic cage. The disorders are usually characterised by a restrictive defect and share the potential of long term hypercapnic respiratory failure. Scoliosis and/or kyphoscoliosis may cause severe respiratory failure. Symptoms of respiratory failure include: dyspnea on exertion, peripheral oedema, orthopnea, repeated chest infections, morning headaches, fatigue, poor sleep quality and loss of appetite. [0012] Otherwise healthy individuals may take advantage of systems and devices to prevent respiratory disorders from arising. 2.2.1 Systems [0013] One known product used for treating sleep disordered breathing is the S9 Sleep Therapy System, manufactured by ResMed. 2.2.2 Therapy [0014] Nasal Continuous Positive Airway Pressure (CPAP) therapy has been used to treat Obstructive Sleep Apnea (OSA). The hypothesis is that continuous positive airway pressure acts as a pneumatic splint and may prevent upper airway occlusion by pushing the soft palate and tongue forward and away from the posterior oropharyngeal wall. [0015] Non-invasive ventilation (NIV) has been used to treat OHS, COPD, MD and Chest Wall disorders. 2.2.3 Patient Interface [0016] The application of a supply of air at positive pressure to the entrance of the airways of a patient is facilitated by the use of a patient interface, such as a nasal mask, full-face mask or nasal pillows. A range of patient interface devices are known, however a number of them suffer from being one or more of obtrusive, aesthetically undesirable, poorly fitting, difficult to use and uncomfortable especially when worn for long periods of time or when a patient is unfamiliar with a system. Masks designed solely for aviators, as part of personal protection equipment or for the administration of anaesthetics may be tolerable for their original application, but nevertheless be undesirably uncomfortable to be worn for extended periods, for example, while sleeping. 2.2.3.1 Seal-forming portion [0017] Patient interfaces typically include a seal-forming portion. [0018] One type of seal-forming portion extends around the periphery of the patient interface, and is intended to seal against the user's face when force is applied to the patient interface with the seal-forming portion in confronting engagement with the user's face. The seal-forming portion may include an air or fluid filled cushion, or a moulded or formed surface of a resilient seal element made of an elastomer such as a mbber. With this type of seal-forming portion, if the fit is not adequate, there will be gaps between the seal-forming portion and the face, and additional force will be required to force the patient interface against the face in order to achieve a seal. [0019] Another type of seal-forming portion incorporates a flap seal of thin material so positioned about the periphery of the mask so as to provide a self-sealing action against the face of the user when positive pressure is applied within the mask. Like the previous style of seal forming portion, if the match between the face and the mask is not good, additional force may be required to effect a seal, or the mask may leak. Furthermore, if the shape of the seal-forming portion does not match that of the patient, it may crease or buckle in use, giving rise to leaks. [0020] Another form of seal-forming portion may use adhesive to effect a seal. Some patients may find it inconvenient to constantly apply and remove an adhesive to their face. [0021] A range of patient interface seal-forming portion technologies are disclosed in the following patent applications, assigned to ResMed Limited: WO 1998/004,310; WO 2006/074,513; WO 2010/135,785. 2.2.3.2 Positioning and stabilising [0022] A seal-forming portion of a patient interface used for positive air pressure therapy is subject to the corresponding force of the air pressure to disrupt a seal. Thus a variety of techniques have been used to position the seal-forming portion, and to maintain it in sealing relation with the appropriate portion of the face. [0023] One technique is the use of adhesives. See for example US Patent publication US 2010/0000534. [0024] Another technique is the use of one or more straps and stabilising harnesses. Many such harnesses suffer from being one or more of ill-fitting, bulky, uncomfortable and awkward to use. 2.2.3.3 Vent technologies [0025] Some forms of patient interface systems may include a vent to allow the washout of exhaled carbon dioxide. Many such vents are noisy. Others may block in use and provide insufficient washout. Some vents may be disruptive of the sleep of a bedpartner 1100 of the patient 1000, e.g. through noise or focussed airflow. [0026] ResMed Limited has developed a number of improved mask vent technologies. See WO 1998/034,665; WO 2000/078,381; US 6,581,594; US Patent Application; US 2009/0050156; US Patent Application 2009/0044808. [0027] Table of noise of prior masks (ISO 17510-2:2007, 10 cmPLO pressure at lm) Mask name Mask type A-weighted sound power level dbA (uncertainty) A-weighted sound pressure dbA (uncertainty) Year (approx.) Glue-on (*) nasal 50.9 42.9 1981 ResCare standard (*) nasal 31.5 23.5 1993 ResMed Mirage (*) nasal 29.5 21.5 1998 ResMed UltraMirage nasal 36(3) 28 (3) 2000 ResMed Mirage Activa nasal 32 (3) 24 (3) 2002 ResMed Mirage Micro nasal 30 (3) 22 (3) 2008 ResMed Mirage SoftGel nasal 29 (3) 22 (3) 2008 ResMed Mirage FX nasal 26 (3) 18(3) 2010 ResMed Mirage Swift (*) nasal pillows 37 29 2004 ResMed Mirage Swift II nasal pillows 28 (3) 20 (3) 2005 ResMed Mirage Swift nasal pillows 25 (3) 17(3) 2008 LT [0028] (* one specimen only, measured using test method specified in IS03744 in CPAP mode at lOcmP^O) [0029] Sound pressure values of a variety of objects are listed below Object A-weighted sound pressure dbA (uncertainty) Notes Vacuum cleaner: Nilfisk Walter Broadly Litter Hog: Β+ Grade 68 IS03744 at lm distance Conversational speech 60 lm distance Average home 50 Quiet library 40 Quiet bedroom at night 30 Background in TV studio 20 2.2.3.4 Nasal pillow technologies [0030] One form of nasal pillow is found in the Adam Circuit manufactured by Puritan Bennett. Another nasal pillow, or nasal puff is the subject of US Patent 4,782,832 (Trimble et al), assigned to Puritan-Bennett Corporation. [0031] ResMed Limited has manufactured the following products that incorporate nasal pillows: SWIFT nasal pillows mask, SWIFT II nasal pillows mask, SWIFT LT nasal pillows mask, SWIFT FX nasal pillows mask and LIBERTY full-face mask. The following patent applications, assigned to ResMed Limited, describe nasal pillows masks: International Patent Application W02004/073,778 (describing amongst other things aspects of ResMed SWIFT nasal pillows), US Patent Application 2009/0044808 (describing amongst other things aspects of ResMed SWIFT LT nasal pillows); International Patent Applications WO 2005/063,328 and WO 2006/130,903 (describing amongst other things aspects of ResMed LIBERTY full-face mask); International Patent Application WO 2009/052,560 (describing amongst other things aspects of ResMed SWIFT FX nasal pillows). 2.2.4 PAP Device [0032] The air at positive pressure is typically supplied to the airway of a patient by a PAP device such as a motor-driven blower. The outlet of the blower is connected via a flexible delivery conduit to a patient interface as described above. 2.2.5 Sleep Detection [0033] Sleep information may be useful for treating and/or diagnosing respiratory issues or may simply be useful for monitoring health. Currently, human sleep stages are typically determined using a laboratory based measurement called polysomnography. In polysomnography, it is typical for several electroencephalogram (EEC) readings to be taken (EEGs are the microvolt potentials generated by brain activity that can be measured at the scalp using electrodes), in addition to other parameters such as respiration, electrocardiogram (ECG), leg movements, and electro-oculograms (EOG). Based on work originally pioneered by Rechtschaffen and Kales (R&K), it is now conventional to score human sleep in 30-second epochs, and to label these epochs using sleep stage labels. [0034] At present, the American Academy of Sleep Medicine defines the stages of sleep as: Wake - this is when a person is fully awake, and is characterized by a positive dominant rhythm in the occipital EEG channel (when eyes are closed), typically in the range 8-14 Hz (often referred to as alpha waves) Stage Ν1 - this is the lightest stage of sleep, and is characterized by the appearance of some low amplitude waves at multiple frequencies interspersed with the alpha waves for >50% of an epoch. There may also be sharp vertex waves, some slow eye movements on the EOG and/or an overall lowering of the frequency of EEG. Stage Ν2 - this is a slightly deeper stage of sleep, and is marked by the appearance of sleep spindles and K-complexes, on a background of mixed frequency signals. Sleep spindles are bursts of higher frequency activity (e.g. >12 Hz). K-complexes are distinct isolated bipolar waves lasting about 1-2 seconds. Stage Ν3 is the deepest stage of sleep (in the original R&K classification, there were two distinct stages called Stage 3 and Stage 4). This is characterised by the appearance of slow waves (e.g., 1-2 Hz frequency) for at least 20% of an epoch. Stage R (REM) - this is rapid eye movement sleep, and is apparent through the presence of distinct activity in the EOG signal. The EEG signals recorded are typically quite similar to Stage Ν1 or even wake. [0035] An automated system from scoring polysomnogram data is discussed in U.S. Patent No. 5732696 to Rapoport et al. The system uses a computer to look for elemental patterns in the PSG data (such as the sleep spindles described above), and then uses a probabilistic weighting to score each epoch. However this approach to the problem of determining sleep stages is limited by the technical difficulty of measurement of a full set of polysomnogram signals, and hence is difficult and cumbersome to implement for more than a single night. [0036] A number of systems have provided alternative solutions to the problem of determining sleep stage. One approach is to use actigraphy, in which small motion sensors (e.g., accelerometers) are worn by a user, typically in a wristwatch configuration. However, such systems have the disadvantage that they can only distinguish between sleep and wake, with poor accuracy in patients with sleep disorders. [0037] US2006/0184056 (Heneghan et al) describes a sleep monitoring system which uses an ECG signal which is processed to determine a status for each epoch, either apneic or normal. [0038] WO2007/143535 (Heneghan et al) describes a system for monitoring physiological signs such as sleep state by monitoring motion, breathing, and heart rate signals obtained in a non-contact fashion. A classifier model is applied to the streams of data. [0039] A system which combines ECG and respiration methods to determine simplified sleep stage is described in US20090131803 (Heneghan et al). This combines signal characteristics derived from cardiogram and respiration signals, such as the amplitude modulation of the ECG signal and the dominant respiratory frequency in order to distinguish sleep from wakefulness. [0040] W02004112606 (Heneghan et al) describes a method of detecting sleep apnea using trans-cervical bioimpedance measurements. [0041] US2011/0124979 (Heneghan et al) describes an approach to sleep monitoring using ECG and photoplethysmogram (PPG) data. These may be sensed using a Holter monitor and a pulse oximeter which are wearable in an ambulatory manner. [0042] An approach in which cardiac R-R wave intervals are used to designate sleep as REM or non-REM is discussed in U.S. Patent No. 5,280,791 to Lavie. A power spectrum of the cardiac R-R interval is calculated in order to determine the stages of sleep. [0043] A US application 2013/0006124, to Eyal and Baharav, discusses the use of a non-ECG device such as a plethysmograph, radar, microphone, accelerometer etc., for measuring patient’s heartbeats, analysing the inter-beat intervals and determining if the subject is in a sleep stage (light sleep, slow wave sleep, REM). 3 BRIEF SUMMARY OF THE TECHNOLOGY [0044] This disclosure has application in the field of sleep research and in providing quality-of-life metrics to individual users. [0045] The present technology is directed towards providing health or medical devices for detection of sleep related information and may optionally be used in the diagnosis, amelioration, treatment, or prevention of respiratory disorders having one or more of improved comfort, cost, efficacy, ease of use and manufacturability. [0046] For example,_this disclosure provides various embodiments and aspects of an apparatus, system and method for determining sleep stage in a non-contact manner. [0047] In one aspect, an apparatus, system, and method is provided for deriving the sleep stage of a human subject based solely on measurement of the bodily movement and respiration movement of the subject. The sleep stages provided can distinguish between deep sleep and all other stages of sleep, or could further differentiate between deep sleep, light sleep and REM sleep. In this context, deep sleep refers to Stage Ν3 as defined by the American Academy of Sleep Medicine. Stage Ν1 and Ν2 are collectively referred to as “light sleep’. The bodily movement and respiration movement may be obtained through a non-invasive sensor such as a pressure sensitive mattress or a radio-frequency motion sensor. The later sensor is also a completely non-contact sensor, as the user does not have to be in mechanical contact with the sensor (In the case of the pressure sensor, some contact is necessary). [0048] Thus, according to the current technology (a) there may be no need for any direct electrical or mechanical contact with the patient, e.g., no ECG, inductance plethysmogram or bioimpedance signals are acquired, (b) there may be no need for cardiac information to be acquired, sleep state estimation is performed solely on movement and respiration signals. Thus, the proposed technology overcomes or ameliorates at least some of the issues with the prior art or proposes a useful alternative. [0049] In one embodiment, a radio-frequency sensor unit can be placed on a bedside table near a subject’s bed, while they sleep. The sensor may be range gated so that its operation can be limited to a specific distance from the sensor, providing it with a required spatial resolution. The sensor unit may communicate with a processor and a display and, in one aspect, the sensor, the processor, and the display may be physically implemented in the same unit. The processor may be used to extract information about breathing and motion, and higher order information such as the sleep stage. A display may be configured to provide feedback to the user, typically at the end of the night, such as displaying a sequence of the overnight sleep stages. Feedback can also be provided real time such that to allow using the presence of sleep to control environmental factors such as the ambient temperature, the ambient light level, the ambient noise or ambient odour. The feedback could also be used to control electronic devices such as radios, televisions or other entertainment devices. In one aspect, a complete system may include one or more of the following: A motion sensor (for detection of general bodily movement and respiration); a processing capability (to derive signals directly related to breathing and motion, and hence to derive sleep stage); a display capability (to provide visual feedback); a lighting and/or light controlling capability (to alter room light), an auditory capability (to provide acoustic feedback, e.g., a white noise generator whose amplitude varies with sleep stage); and/or a communications capability (wired or wireless) to transmit acquired data to a separate unit. The same or separate unit may be configured to carry out the processing, display, lighting and auditory functions mentioned above. The separate unit could be a local device such as a cellular phone or tablet computer, or it could be a remote computer. [0050] In one or more embodiments, the disclosed system measures the respiration and/or movement signal by way of one or more sensors configured to receive a reflected radio-frequency signal off a living subject. A processor is configured to analyze the reflected signal to determine a measurement of movement and respiration, and hence sleep stage; and a display arranged to provide selected information relating to one or more of breathing, movement and sleep stage to a user of the system. The system may further comprise a transmitter that generates the radio frequency signals that are reflected off the living subject, and the power levels emitted by the system are safe for continuous use with humans. [0051] In another embodiment, a method for measuring and analyzing respiration, cardiac activity, and bodily movement includes receiving radio-frequency signals reflected from a human subject; analyzing the reflected signals to produce measurements relating to movement and respiration, and hence sleep stage; and providing selected information to a user of the system, which may be displayed on a screen. [0052] In one aspect, the invention provides a method for classifying sleep stages of a subject, the method comprising: detecting one or more signals related to bodily movement and respiration movements of the subject; and analyzing at least a portion of the detected signals to calculate the variability of the respiration rate and/or respiration amplitude; and combining the respiration variability with the bodily movement detection to determine sleep stage. [0053] In one embodiment, the analysis determines respiration rate and respiration amplitude. A processing means is provided to take the original movement signal (the entire or raw detected movement signal) and to split it into “respiration” and “non-respiration” signals, by using frequency domain filtering (for example, most respiration effort signals are below 0.5 Hz so a low-pass filter can isolate only the respiration-related parts of the signal. The respiration rate and the respiration amplitude can then be calculated from just this part of the signal. However, the method may include analyzing the entire/raw detected signal to classify the sleep stages of the subject, since the non-respiration signal movement components typically reflect movements which are also useful to determine sleep state. Preferably, the detection of the one or more signals is performed in a non-contact manner. [0054] In one embodiment, the method comprises the detection of the presence or absence of a person. Preferably, the analysis comprises a simplified sleep staging calculation in which the outputs are sleep or awake only. In one embodiment, detected signals are processed to estimate a respiratory rate of the subject. In one embodiment, detected signals are processed to estimate the respiratory amplitude of the subject. Preferably, an estimate of the respiratory rate is made on an epoch basis (e.g., over a 30-second epoch). In one embodiment, the analysis includes choosing a respiration stability threshold value depending on a comparison of the variation in amplitude of the measured respiratory signal with an amplitude threshold value. Preferably, the analysis includes choosing a respiration rate stability threshold value depending on a comparison of the variability of the measured respiratory rate signal with a threshold value. [0055] In one embodiment, the analysis comprises calculating a respiration rate range for each of a number of epochs, based on the minimum and the maximum values of the respiration rates of each of the respective epochs. Preferably, the method comprises: a. comparing the calculated respiration range with a chosen stability threshold value for the epoch; and b. classifying the epoch as a deep sleep if the calculated respiration range is smaller than the chosen stability threshold, or otherwise classifying the epoch as light sleep. [0056] In one embodiment, a light sleep epoch is encountered, the sequence length of prior deep sleep epochs and, if the number of preceding epochs of deep sleep epochs encountered since the last light sleep epoch is less than a predetermined number, reclassifying these epoch as light sleep. In one embodiment, the predetermined number is five. [0057] In one embodiment, the method comprises classifying periods of sleep as either deep sleep or REM sleep on the basis of the variation of the breathing rate during the period. [0058] In one embodiment, the method includes classifying a period as either a deep sleep or a REM sleep period, based on whether a combination of features derived from spectral analysis and approximate entropy analysis for the period is smaller or larger, respectively, than a threshold value. In one embodiment, non-contact radio frequency based sensors are used, and the analysis provides quadrature signals I and Q which represent the detected movement observed from positions 90° apart in the phase space of a transmitter. [0059] In one embodiment, the analysis uses respiration rate variability and respiration amplitude variability to determine sleep stage. In one embodiment, the analysis uses variability of the respiration rate and amplitude to distinguish REM sleep, in which a period of relatively high variation of the breathing rate is considered as an indication of an REM sleep period, and a period of relatively low variation of the breathing rate is considered to be associated with a state of deep sleep. In one embodiment, the analysis comprises assessing the variability of a time series using the approximate entropy, which assumes lower values for predictable time-series, and higher values as the time-sequence becomes more variable. Preferably, the analysis provides a continuous respiration rate and respiration amplitude estimate, and the respiration rate is then fed into two processing blocks in segments, in which a block will output a single number for an epoch which is the approximate entropy of that segment of the signal. [0060] In another aspect, the invention provides a system for classifying sleep stages of a subject, the system comprising: one or more sensors configured to detect one or more signals which relate to bodily movement and respiration related movements; and a processor configured to analyze at least a portion of the detected signals to calculate the variability of the respiration rate and/or respiration amplitude; and to combine the respiration variability with the bodily movement detection to determine sleep stage. [0061] In one embodiment, at least one of the one or more sensors is a non-contact sensor. In one embodiment, the at least one non-contact sensor is a radio frequency based sensor. In one embodiment, the at least one non-contact radio sensor is range gated. [0062] Some versions of the present technology may involve a method of a processor of an apparatus for classifying sleep stages of a subject. The method may include accessing a plurality of signals related to bodily movement and/or respiration movements of the subject. The method may include selecting one of the plurality of signals for processing. The method may include processing the selected signal by wavelet transform. The method may include generating a mask corresponding to the transformed signal. The method may also include extracting features from the transformed signal in accordance with the mask. The method may also include classifying a sleep stage based on the extracted features. [0063] In some cases, a processor may select the one of the plurality of signals by detecting a greatest in-band breathing power. In some cases, the method may further include with a processor extracting breath statistics from the transformed signal, and the classifying of the sleep stage may be further based on the breath statistics. The breath statistics may include one or more of a mean of breath interval, a mean of breath amplitude, variation of breath interval and variation of breath amplitude. [0064] In some cases, the extracted features may include one or more of a power in a highest wavelet detail just above a breathing band and a power in approximation coefficients. Optionally, the generated mask may indicate noise for particular portions of the transformed signal. The generated mask may be a binary map of the transformed signal. [0065] In some cases, the classifying may include linear discriminant analysis. The method may further include detecting a pattern of classified sleep stages and correcting an errant classification based on the detected pattern. Optionally, the method may further include displaying a classified sleep stage. The sleep stages may include a series of one or more of a wake stage, light sleep stage, a deep sleep stage and a rem sleep stage. [0066] In some cases, the method(s) may be implemented by a a system for classifying sleep stages of a subject. The system may include one or more sensors configured to detect a plurality of signals which relate to bodily movement and respiration related movements. The system may also include a processor configured to process the plurality of signals, select one of the plurality of signals for processing, process the selected signal by wavelet transform, generate a mask corresponding to the transformed signal, extract features from the transformed signal in accordance with the mask, and classify a sleep stage based on the extracted features. In some cases, the at least one of the one or more sensors is a non-contact sensor, which may be a radio frequency based sensor or one that is range gated. The system may further include a respiratory treatment apparatus. The respiratory treatment apparatus may include a flow generator adapted to couple with a patient interface. It may also include a controller configured to set an treatment operation of the flow generator. The controller may be in communication with the processor and configured to control a treatment pressure based, in part, on the determined sleep stage. [0067] In a further aspect, the invention provides a computer readable medium comprising software code adapted to perform the steps of any of the methods as described herein in any embodiment, when executing on a digital processor. [0068] Of course, portions of the aspects may form sub-aspects of the present technology. Also, various ones of the sub-aspects and/or aspects may be combined in various manners and also constitute additional aspects or sub-aspects of the present technology. [0069] Other features of the technology will be apparent from consideration of the information contained in the following detailed description, abstract, drawings and claims. 4 BRIEF DESCRIPTION OF THE SEVERAL VIEWS OF THE DRAWINGS [0070] The present technology is illustrated by way of example, and not by way of limitation, in the figures of the accompanying drawings, in which like reference numerals refer to similar elements including: 4.1 TREATMENT SYSTEMS [0071] Fig. la shows a system in accordance with the present technology. A patient 1000 wearing a patient interface 3000, receives a supply of air at positive pressure from a PAP device 4000. Air from the PAP device is humidified in a humidifier 5000, and passes along an air circuit 4170 to the patient 1000. [0072] Fig. lb shows a PAP device in use on a patient with a nasal mask. [0073] Fig. lc shows a PAP device in use on a patient with a full-face mask. 4.2 THERAPY 4.2.1 Respiratory system [0074] Fig. 2a shows an overview of a human respiratory system including the nasal and oral cavities, the larynx, vocal folds, oesophagus, trachea, bronchus, lung, alveolar sacs, heart and diaphragm. [0075] Fig. 2b shows a view of a human upper airway including the nasal cavity, nasal bone, lateral nasal cartilage, greater alar cartilage, nostril, lip superior, lip inferior, larynx, hard palate, soft palate, oropharynx, tongue, epiglottis, vocal folds, oesophagus and trachea. 4.3 PATIENT INTERFACE [0076] Fig. 3 shows a patient interface in accordance with one form of the present technology. 4.4 PAP DEVICE [0077] Fig. 4a shows a PAP device in accordance with one form of the present technology. [0078] Fig. 4b shows a schematic diagram of the pneumatic circuit of a PAP device in accordance with one form of the present technology. The directions of upstream and downstream are indicated. [0079] Fig. 4c shows a schematic diagram of the electrical components of a PAP device in accordance with one aspect of the present technology. [0080] Fig. 4d shows a schematic diagram of example processes or algorithms implemented in a PAP device in accordance with an aspect of the present technology. In this figure, arrows with solid lines indicate an actual flow of information, for example via an electronic signal. 4.5 HUMIDIFIER [0081] Fig. 5 shows an example humidifier in accordance with one aspect of the present technology. 4.6 BREATHING WAVEFORMS [0082] Fig. 6a shows a model typical breath waveform of a person while sleeping. The horizontal axis is time, and the vertical axis is respiratory flow. While the parameter values may vary, a typical breath may have the following approximate values: tidal volume, Vt, 0.5L, inhalation time, Ti, 1.6s, peak inspiratory flow, Qpeak, 0.4 L/s, exhalation time, Te, 2.4s, peak expiratory flow, Qpeak, -0.5 L/s. The total duration of the breath, Ttot, is about 4s. The person typically breathes at a rate of about 15 breaths per minute (ΒΡΜ), with Ventilation, Vent, about 7.5 L/minute. A typical duty cycle, the ratio of Ti to Ttot is about 40%. [0083] Fig. 6b shows a patient during Non-REM sleep breathing normally over a period of about ninety seconds, with about 34 breaths, being treated with Automatic PAP, and the mask pressure being about 11 cmEEO. The top channel shows oximetry (Sp02), the scale has a range of saturation from 90 to 99% in the vertical direction. The patient maintained a saturation of about 95% throughout the period shown. The second channel shows quantitative respiratory airflow, and the scale ranges from -1 to +1 LPS in a vertical direction, and with inspiration positive. Thoracic and abdominal movement are shown in the third and fourth channels. [0084] Fig. 6c shows polysomnography of a patient before a treatment. There are eleven signal channels from top to bottom with a 6 minute horizontal span. The top two channels both are EEG (electoencephalogram) from different scalp locations. Periodic spikes in second represent cortical arousal and related activity. The third channel down is submental EMG (electromyogram). Increasing activity around time of arousals represent genioglossus recmitment. The fourth & fifth channels are EOG (electro-oculogram). The sixth channel is an electocardiogram. The seventh channel shows pulse oximetry (Sp02) with repetitive desaturations to below 70% from about 90%. The eighth channel is respiratory airflow using nasal cannula connected to differential pressure transducer. Repetitive apneas of 25 to 35 seconds alternating with 10 to 15 second bursts of recovery breathing coinciding with EEG arousal and increased EMG activity. The ninth shows movement of chest and tenth shows movement of abdomen. The abdomen shows a crescendo of movement over the length of the apnea leading to the arousal. Both become untidy during the arousal due to gross body movement during recovery hyperpnea. The apneas are therefore obstmctive, and the condition is severe. The lowest channel is posture, and in this example it does not show change. [0085] Fig. 6d shows patient flow data where the patient is experiencing a series of total obstmctive apneas. The duration of the recording is approximately 160 seconds. Flow ranges from about +1 L/s to about -1.5L/s. Each apnea lasts approximately 10-15s. [0086] Fig. 6e shows a scaled inspiratory portion of a breath where the patient is experiencing low frequency inspiratory snore. [0087] Fig. 6f shows a scaled inspiratory portion of a breath where the patient is experiencing an example of flattened inspiratory flow limitation. [0088] Fig. 6g shows a scaled inspiratory portion of a breath where the patient is experiencing an example of “mesa” flattened inspiratory flow limitation. [0089] Fig. 6h shows a scaled inspiratory portion of a breath where the patient is experiencing an example of “panda ears” inspiratory flow limitation. [0090] Fig. 6i shows a scaled inspiratory portion of a breath where the patient is experiencing an example of "chair" inspiratory flow limitation. [0091] Fig. 6j shows a scaled inspiratory portion of a breath where the patient is experiencing an example of "reverse chair" inspiratory flow limitation. [0092] Fig. 6k shows a scaled inspiratory portion of a breath where the patient is experiencing an example of “M-shaped” inspiratory flow limitation. [0093] Fig. 61 shows a scaled inspiratory portion of a breath where the patient is experiencing an example of severely “M-shaped” inspiratory flow limitation. [0094] Fig. 6m shows data for a patient with Cheyne-Stokes respiration. There are three channels- oxygen saturation (Sp02), a signal indicative of flow and the third, movement. The data span six minutes. The signal representative of flow was measured using a pressure sensor connected to nasal cannulae. The patient exhibits apneas of about 22 seconds and hyperpneas of about 38 seconds. Fligher frequency low amplitude oscillation during apnea is cardiogenic. [0095] Fig. 6η shows data for a patient with another example of Cheyne-Stokes respiration, using the same three channels as in Fig. 6m. The data span ten minutes. Generally, in the flow data signal of Fig. 6η the patient is experiencing hypopneas in place of the apneas illustrated in Fig. 6m. 4.7 MONITORING SYSTEMS [0096] Fig. 7 shows an example non-contact apparatus for monitoring the respiration and/or movement of a patient. It also illustrates how a system of an embodiment might be used in assessment of sleep stage, wherein the system is placed at a bedside table and acquires measurements relating to the movement and breathing of the subject. 4.8 Sleep Stage Processing [0097] FIG. 8 is a schematic representation of the overall processing of the movement and respiratory signals, in which various levels of outputs are possible, namely, an indicator of whether a subject is present or absent, an indication of whether a person is asleep or awake, or an indication of the sleep stage. [0098] FIG. 9 illustrates a sensor signal divided into epochs, with each epoch associated with a respiration rate. [0099] FIG. 10 is a flow diagram of the processing that may be implemented to determine whether a person is in deep sleep (Stage Ν3 described previously). [0100] FIG. 11 shows example processes for the classification of a period of sleep on the basis of the variation of the respiration rate and amplitude signals during the period. [0101] FIG. 12 shows an example of (a) a respiration rate signal and (b) a normalized respiration amplitude signal as a function of time. [0102] FIG. 13 illustrates an analysis of the power spectral density (PSD) estimate of the respiration rate signal, in which the top graph of FIG. 13 shows a linear fit to the log-log plot of the PSD, and bottom graph shows the power contained within various spectral bands. [0103] FIG. 14 shows a plot of the respiration rate over a period of time, the internal discriminant value of the classifier, and the final output of the sleep stage classifier shown in FIG. 11, thus illustrating how an output indication of a sleep stage (REM Sleep) can be derived from respiration signals. [0104] FIG. 15 is an output diagram showing how the system assigns data (e.g., sleep stage indications) chronologically to epochs. [0105] FIG. 16 is a processing diagram illustrating example processes or processing components that may be involved in a sleep stage detector suitable for implementation in some embodiments of the present technology. 5 DETAILED DESCRIPTION OF EXAMPLES OF THE TECHNOLOGY [0106] Before the present technology is described in further detail, it is to be understood that the technology is not limited to the particular examples described herein, which may vary. It is also to be understood that the terminology used in this disclosure is for the purpose of describing only the particular examples discussed herein, and is not intended to be limiting. 5.1 TREATMENT SYSTEMS [0107] In one form, the present sleep stage monitor technology may be incorporated within or in communication (wired or wireless) with apparatus for treating a respiratory disorder. The apparatus may comprise a flow generator or blower for supplying pressurised respiratory gas, such as air, to the patient 1000 via an air delivery tube leading to a patient interface 3000. 5.2 THERAPY [0108] In one form, the present technology comprises a method for treating a respiratory disorder comprising the step of applying or adjusting positive pressure to the entrance of the airways of a patient 1000, such as in response to or based upon a particular detection of sleep stage made by the sleep stage monitor. The treatment (e.g. positive pressure) may be any type such as a CPAP treatment, automatic titrating pressure (ΑΡΑΡ), bi-level PAP or other suitable respiratory treatment. 5.2.1 Nasal CPAP for OSA [0109] For example, in one form, the present technology comprises a method of treating Obstmctive Sleep Apnea in a patient by applying nasal continuous positive airway pressure to the patient. [0110] In certain embodiments of the present technology, a supply of air at positive pressure is provided to the nasal passages of the patient via one or both nares. [0111] In certain embodiments of the present technology, mouth breathing is limited, restricted or prevented. 5.3 PATIENT INTERFACE 3000 [0112] A non-invasive patient interface 3000 in accordance with one aspect of the present technology may optionally include any one or more of the following functional aspects: a seal-forming stmcture 3100, a plenum chamber 3200, a positioning and stabilising stmcture 3300 and a connection port 3600 for connection to air circuit 4170. In some forms a functional aspect may be provided by one or more physical components. In some forms, one physical component may provide one or more functional aspects. In use the seal-forming stmcture 3100 is arranged to surround an entrance to the airways of the patient so as to facilitate the supply of air at positive pressure to the airways. 5.3.1 Seal-forming structure 3100 [0113] In one form of the present technology, a seal-forming stmcture 3100 provides a sealing-forming surface, and may additionally provide a cushioning function. [0114] A seal-forming stmcture 3100 in accordance with the present technology may be constmcted from a soft, flexible, resilient material such as silicone. [0115] In one form, the seal-forming stmcture 3100 comprises a sealing flange 3110 and a support flange 3120. Preferably the sealing flange 3110 comprises a relatively thin member with a thickness of less than about 1mm, for example about 0.25mm to about 0.45mm, that extends around the perimeter 3210 of the plenum chamber 3200. Support flange 3120 may be relatively thicker than the sealing flange 3110. The support flange 3120 is disposed between the sealing flange 3110 and the marginal edge 3220 of the plenum chamber 3200, and extends at least part of the way around the perimeter 3210. The support flange 3120 is or includes a spring-like element and functions to support the sealing flange 3110 from buckling in use. In use the sealing flange 3110 can readily respond to system pressure in the plenum chamber 3200 acting on its underside to urge it into tight sealing engagement with the face. [0116] In one form the seal-forming portion of the non-invasive patient interface 3000 comprises a pair of nasal puffs, or nasal pillows, each nasal puff or nasal pillow being constmcted and arranged to form a seal with a respective naris of the nose of a patient. [0117] Nasal pillows in accordance with an aspect of the present technology include: a frusto-cone, at least a portion of which forms a seal on an underside of the patient's nose; a stalk, a flexible region on the underside of the cone and connecting the cone to the stalk. In addition, the stmcture to which the nasal pillow of the present technology is connected includes a flexible region adjacent the base of the stalk. The flexible regions can act in concert to facilitate a universal joint structure that is accommodating of relative movementboth displacement and angular- of the fmsto-cone and the structure to which the nasal pillow is connected. For example, the frusto-cone may be axially displaced towards the stmcture to which the stalk is connected. [0118] In one form the non-invasive patient interface 3000 comprises a seal-forming portion that forms a seal in use on an upper lip region (that is, the lip superior) of the patient's face. [0119] In one form the non-invasive patient interface 3000 comprises a seal-forming portion that forms a seal in use on a chin-region of the patient's face. 5.3.2 Plenum chamber 3200 [0120] Preferably the plenum chamber 3200 has a perimeter 3210 that is shaped to be complementary to the surface contour of the face of an average person in the region where a seal will form in use. In use, a marginal edge 3220 of the plenum chamber 3200 is positioned in close proximity to an adjacent surface of the face. Actual contact with the face is provided by the seal-forming stmcture 3100. Preferably the seal-forming stmcture 3100 extends in use about the entire perimeter 3210 of the plenum chamber 3200. 5.3.3 Positioning and stabilising structure 3300 [0121] Preferably the seal-forming portion of the patient interface 3000 of the present technology is held in sealing position in use by the positioning and stabilising structure 3300. 5.3.4 Vent 3400 [0122] In one form, the patient interface 3000 includes a vent 3400 constmcted and arranged to allow for the washout of exhaled carbon dioxide. [0123] One form of vent 3400 in accordance with the present technology comprises a plurality of holes, for example, about 20 to about 80 holes, or about 40 to about 60 holes, or about 45 to about 55 holes. [0124] Preferably the vent 3400 is located in the plenum chamber 3200. Alternatively, the vent 3400 is located in a decoupling stmcture 3500, e.g. a swivel 3510. 5.3.5 Decoupling structure(s) 3500 [0125] In one form the patient interface 3000 includes at least one decoupling stmcture 3500, for example a swivel 3510 or a ball and socket 3520. 5.3.6 Connection port 3600 [0126] Connection port 3600 allows for connection to the air circuit 4170. 5.3.7 Forehead support 3700 [0127] In one form, the patient interface 3000 includes a forehead support 3700. 5.3.8 Anti-asphyxia valve 3800 [0128] In one form, the patient interface 3000 includes an anti-asphyxia valve 3800. 5.3.9 Ports 3900 [0129] In one form of the present technology, a patient interface 3000 includes one or more ports, that allow access to the volume within the plenum chamber 3200. In one form this allows a clinician to supply supplemental oxygen. In one form this allows for the direct measurement of a property of gases within the plenum chamber 3200, such as the pressure. 5.4 PAP DEVICE 4000 [0130] An example PAP device 4000 in accordance with one aspect of the present technology may be formed with mechanical and pneumatic components 4100, electrical components 4200 and may be programmed to execute one or more algorithms 4300. The PAP device preferably has an external housing 4010, preferably formed in two parts, an upper portion 4012 of the external housing 4010, and a lower portion 4014 of the external housing 4010. In alternative forms, the external housing 4010 may include one or more panel(s) 4015. Preferably the PAP device 4000 comprises a chassis 4016 that supports one or more internal components of the PAP device 4000. In one form a pneumatic block 4020 is supported by, or formed as part of the chassis 4016. The PAP device 4000 may include a handle 4018. [0131] The pneumatic path of the PAP device 4000 preferably comprises an inlet air filter 4112, an inlet muffler 4122, a controllable pressure device 4140 capable of supplying air at positive pressure (preferably a blower 4142), and an outlet muffler 4124. One or more pressure sensors and flow sensors are included in the pneumatic path. [0132] The preferred pneumatic block 4020 comprises a portion of the pneumatic path that is located within the external housing 4010. [0133] The PAP device 4000 preferably has an electrical power supply 4210, one or more input devices 4220, a central controller 4230, a therapy device controller 4240, a therapy device 4245, one or more protection circuits 4250, memory 4260, transducers 4270, data communication interface 4280 and one or more output devices 4290. Electrical components 4200 may be mounted on a single Printed Circuit Board Assembly (PCBA) 4202. In an alternative form, the PAP device 4000 may include more than one PCBA 4202. [0134] The central controller 4230 of the PAP device 4000 is programmed to execute one or more algorithm modules 4300, preferably including a pre-processing module 4310, a therapy engine module 4320, a pressure control module 4330, and further preferably a fault condition module 4340. 5.4.1 PAP device mechanical & pneumatic components 4100 5.4.1.1 Air filter(s) 4110 [0135] A PAP device in accordance with one form of the present technology may include an air filter 4110, or a plurality of air filters 4110. [0136] In one form, an inlet air filter 4112 is located at the beginning of the pneumatic path upstream of a blower 4142. See Fig. 4b. [0137] In one form, an outlet air filter 4114, for example an antibacterial filter, is located between an outlet of the pneumatic block 4020 and a patient interface 3000. See Fig. 4b. 5.4.1.2 Muffler(s) 4120 [0138] In one form of the present technology, an inlet muffler 4122 is located in the pneumatic path upstream of a blower 4142. See Fig. 4b. [0139] In one form of the present technology, an outlet muffler 4124 is located in the pneumatic path between the blower 4142 and a patient interface 3000. See Fig. 4b. 5.4.1.3 Pressure device 4140 [0140] In an example form of the present technology, a pressure device 4140 for producing a flow of air at positive pressure is a controllable blower 4142. For example the blower may include a brushless DC motor 4144 with one or more impellers housed in a volute. The blower may be preferably capable of delivering a supply of air, for example about 120 litres/minute, at a positive pressure in a range from about 4 cmFFO to about 20 cmFFO, or in other forms up to about 30 cmFFO. [0141] The pressure device 4140 may be under the control of the therapy device controller 4240. 5.4.1.4 Transducer(s) 4270 [0142] In one form of the present technology, one or more transducers 4270 are located upstream of the pressure device 4140. The one or more transducers 4270 are constructed and arranged to measure properties of the air at that point in the pneumatic path. [0143] In one form of the present technology, one or more transducers 4270 are located downstream of the pressure device 4140, and upstream of the air circuit 4170. The one or more transducers 4270 are constructed and arranged to measure properties of the air at that point in the pneumatic path. [0144] In one form of the present technology, one or more transducers 4270 are located proximate to the patient interface 3000. 5.4.1.5 Anti-spill back valve 4160 [0145] In one form of the present technology, an anti-spill back valve is located between the humidifier 5000 and the pneumatic block 4020. The anti-spill back valve is constructed and arranged to reduce the risk that water will flow upstream from the humidifier 5000, for example to the motor 4144. 5.4.1.6 Air circuit 4170 [0146] An air circuit 4170 in accordance with an aspect of the present technology is constructed and arranged to allow a flow of air or breathable gasses between the pneumatic block 4020 and the patient interface 3000. 5.4.1.7 Oxygen delivery [0147] In one form of the present technology, supplemental oxygen 4180 is delivered to a point in the pneumatic path. [0148] In one form of the present technology, supplemental oxygen 4180 is delivered upstream of the pneumatic block 4020. [0149] In one form of the present technology, supplemental oxygen 4180 is delivered to the air circuit 4170. [0150] In one form of the present technology, supplemental oxygen 4180 is delivered to the patient interface 3000. 5.4.2 PAP device electrical components 4200 5.4.2.1 Basic PAP device [0151] Some basic PAP devices, such as PAP device 4000, are essentially electromechanical devices that do not include processing capabilities. 5.4.2.1.1 Power supply 4210 [0152] Power supply 4210 supplies power to the other components of the basic PAP device 4000: the input device 4220, the central controller 4230, the therapy device 4245, and the output device 4290. [0153] In one form of the present technology, power supply 4210 is internal of the external housing 4010 of the PAP device 4000. In another form of the present technology, power supply 4210 is external of the external housing 4010 of the PAP device 4000. 5.4.2.1.2 Input device(s) 4220 [0154] Input devices 4220 comprises buttons, switches or dials to allow a person to interact with the PAP device 4000. The buttons, switches or dials may be physical devices, or software devices accessible via a touch screen. The buttons, switches or dials may, in one form, be physically connected to the external housing 4010, or may, in another form, be in wireless communication with a receiver that is in electrical connection to the central controller 4230. [0155] In one form the input device 4220 may be constructed and arranged to allow a person to select a value and/or a menu option. 5.4.2.1.3 Central controller 4230 [0156] In one form of the present technology, the central controller 4230 is a dedicated electronic circuit configured to receive input signal(s) from the input device 4220, and to provide output signal(s) to the output device 4290 and / or the therapy device controller 4240. [0157] In one form, the central controller 4230 is an application-specific integrated circuit. In another form, the central controller 4230 comprises discrete electronic components. 5.4.2.1.4 Therapy device 4245 [0158] In one form of the present technology, the therapy device 4245 is configured to deliver therapy to a patient 1000 under the control of the central controller 4230. Preferably the therapy device 4245 is a positive air pressure device 4140. 5.4.2.1.5 Output device 4290 [0159] An output device 4290 in accordance with the present technology may take the form of one or more of a visual, audio, and haptic output. A visual output may be a Liquid Crystal Display (LCD) or Light Emitting Diode (LED) display. An audio output may be a speaker or audio tone emitter. 5.4.2.2 Microprocessor-controlled PAP device 5.4.2.2.1 Power supply 4210 [0160] In one form of the present technology power supply 4210 is internal of the external housing 4010 of the PAP device 4000. In another form of the present technology, power supply 4210 is external of them. [0161] In one form of the present technology power supply 4210 provides electrical power to the PAP device 4000 only. In another form of the present technology, power supply 4210 provides electrical power to both PAP device 4000 and humidifier 5000. 5.4.2.2.2 Input devices 4220 [0162] In one form of the present technology, a PAP device 4000 includes one or more input devices 4220 in the form of buttons, switches or dials to allow a person to interact with the device. The buttons, switches or dials may be physical devices, or software devices accessible via a touch screen. The buttons, switches or dials may, in one form, be physically connected to the external housing 4010, or may, in another form, be in wireless communication with a receiver that is in electrical connection to the central controller 4230. [0163] In one form the input device 4220 may be constructed and arranged to allow a person to select a value and/or a menu option. 5.4.2.23 Central controller 4230 [0164] In one form of the present technology, the central controller 4230 is a processor suitable to control a PAP device 4000 such as an χ86 INTEL processor. [0165] A processor suitable to control a PAP device 4000 in accordance with another form of the present technology includes a processor based on ARM Cortex-M processor from ARM Holdings. For example, an STM32 series microcontroller from ST MICROELECTRONICS may be used. [0166] Another processor suitable to control a PAP device 4000 in accordance with a further alternative form of the present technology includes a member selected from the family ARM9-based 32-bit RISC CPUs. For example, an STR9 series microcontroller from ST MICROELECTRONICS may be used. [0167] In certain alternative forms of the present technology, a 16-bit RISC CPU may be used as the processor for the PAP device 4000. For example a processor from the MSP430 family of microcontrollers, manufactured by TEXAS INSTRUMENTS, may be used. [0168] The processor is configured to receive input signal(s) from one or more transducers 4270, and one or more input devices 4220. [0169] The processor is configured to provide output signal(s) to one or more of an output device 4290, a therapy device controller 4240, a data communication interface 4280 and humidifier controller 5250. [0170] The processor, or multiple such processors, is configured to implement the one or more methodologies described herein such as the one or more algorithms 4300 expressed as computer programs stored in a computer readable storage medium, such as memory 4260. In some cases, as previously discussed, such processor(s) may be integrated with a PAP device 4000. However, in some devices the processor(s) may be implemented discretely from the flow generation components of the PAP device, such as for purpose of performing any of the methodologies described herein without directly controlling delivery of a respiratory treatment. For example, such a processor may perform any of the methodologies described herein for purposes of determining control settings for a ventilator or other respiratory related events by analysis of stored data such as from any of the sensors described herein. 5.4.2.2.4 Clock 4232 [0171] Preferably PAP device 4000 includes a clock 4232 that is connected to processor. 5.4.2.2.5 Therapy device controller 4240 [0172] In one form of the present technology, therapy device controller 4240 is a pressure control module 4330 that forms part of the algorithms 4300 executed by the processor. [0173] In one form of the present technology, therapy device controller 4240 is a dedicated motor control integrated circuit. For example, in one form a MC33035 brushless DC motor controller, manufactured by ONSEMI is used. 5.4.2.2.6 Protection circuits 4250 [0174] Preferably a PAP device 4000 in accordance with the present technology comprises one or more protection circuits 4250. [0175] One form of protection circuit 4250 in accordance with the present technology is an electrical protection circuit. [0176] One form of protection circuit 4250 in accordance with the present technology is a temperature or pressure safety circuit. 5.4.2.2.7 Memory 4260 [0177] In accordance with one form of the present technology the PAP device 4000 includes memory 4260, preferably non-volatile memory. In some forms, memory 4260 may include battery powered static RAM. In some forms, memory 4260 may include volatile RAM. [0178] Preferably memory 4260 is located on PCBA 4202. Memory 4260 may be in the form of EEPROM, or NAND flash. [0179] Additionally or alternatively, PAP device 4000 includes removable form of memory 4260, for example a memory card made in accordance with the Secure Digital (SD) standard. [0180] In one form of the present technology, the memory 4260 acts as a computer readable storage medium on which is stored computer program instructions expressing the one or more methodologies described herein, such as the one or more algorithms 4300. 5.4.2.2.8 Transducers 4270 [0181] Transducers may be internal of the device, or external of the PAP device. External transducers may be located for example on or form part of the air delivery circuit, e.g. the patient interface. External transducers may be in the form of non-contact sensors such as a Doppler radar movement sensor that transmit or transfer data to the PAP device. 5.4.2.2.8.1 Flow [0182] A flow transducer 4274 in accordance with the present technology may be based on a differential pressure transducer, for example, an SDP600 Series differential pressure transducer from SENSIRION. The differential pressure transducer is in fluid communication with the pneumatic circuit, with one of each of the pressure transducers connected to respective first and second points in a flow restricting element. Other flow sensors may be implemented such as a hot wire mass airflow sensor. [0183] In use, a signal representing total flow Qt from the flow transducer 4274 is received by the processor. 5.4.2.2.8.2 Pressure 4272 [0184] A pressure transducer 4272 in accordance with the present technology is located in fluid communication with the pneumatic circuit. An example of a suitable pressure transducer is a sensor from the HONEYWELL ASDX series. An alternative suitable pressure transducer is a sensor from the ΝΡΑ Series from GENERAL ELECTRIC. [0185] In use, a signal from the pressure transducer 4272, is received by the processor. In one form, the signal from the pressure transducer 4272 is filtered prior to being received by the processor. 5.4.2.2.8.3 Motor speed 4276 [0186] In one form of the present technology a motor speed signal 4276 is generated. A motor speed signal 4276 is preferably provided by therapy device controller 4240. Motor speed may, for example, be generated by a speed sensor, such as a Hall effect sensor. 5.4.2.2.9 Data communication systems [0187] In one preferred form of the present technology, a data communication interface 4280 is provided, and is connected to processor. Data communication interface 4280 is preferably connectable to remote external communication network 4282. Data communication interface 4280 is preferably connectable to local external communication network 4284. Preferably remote external communication network 4282 is connectable to remote external device 4286. Preferably local external communication network 4284 is connectable to local external device 4288. [0188] In one form, data communication interface 4280 is part of processor. In another form, data communication interface 4280 is an integrated circuit that is separate from processor. [0189] In one form, remote external communication network 4282 is the Internet. The data communication interface 4280 may use wired communication (e.g. via Ethernet, or optical fibre) or a wireless protocol to connect to the Internet. [0190] In one form, local external communication network 4284 utilises one or more communication standards, such as Bluetooth, or a consumer infrared protocol. [0191] In one form, remote external device 4286 is one or more computers, for example a cluster of networked computers. In one form, remote external device 4286 may be virtual computers, rather than physical computers. In either case, such remote external device 4286 may be accessible to an appropriately authorised person such as a clinician. [0192] Preferably local external device 4288 is a personal computer, mobile phone, tablet or remote control. 5.4.2.2.10 Output devices including optional display, alarms [0193] An output device 4290 in accordance with the present technology may take the form of one or more of a visual, audio and haptic unit. A visual display may be a Liquid Crystal Display (LCD) or Light Emitting Diode (LED) display. 5.4.2.2.10.1 Display driver 4292 [0194] A display driver 4292 receives as an input the characters, symbols, or images intended for display on the display 4294, and converts them to commands that cause the display 4294 to display those characters, symbols, or images. 5.4.2.2.10.2 Display 4294 [0195] A display 4294 is configured to visually display characters, symbols, or images in response to commands received from the display driver 4292. Lor example, the display 4294 may be an eight-segment display, in which case the display driver 4292 converts each character or symbol, such as the figure “0”, to eight logical signals indicating whether the eight respective segments are to be activated to display a particular character or symbol. 5.4.3 PAP device algorithms 4300 5.4.3.1 Pre-processing module 4310 [0196] An pre-processing module 4310 in accordance with the present technology receives as an input, raw data from a transducer, for example a flow or pressure transducer, and preferably performs one or more process steps to calculate one or more output values that will be used as an input to another module, for example a therapy engine module 4320. [0197] In one form of the present technology, the output values include the interface or mask pressure Pm, the respiratory flow Qr, and the leak flow Ql. [0198] In various forms of the present technology, the pre-processing module 4310 comprises one or more of the following algorithms: pressure compensation algorithm 4312, vent flow algorithm 4314, leak flow algorithm 4316, respiratory flow algorithm 4318, and jamming detection 4319. 5.4.3.1.1 Pressure compensation 4312 [0199] In one form of the present technology, a pressure compensation algorithm 4312 receives as an input a signal indicative of the pressure in the pneumatic path proximal to an outlet of the pneumatic block. The pressure compensation algorithm 4312 estimates the pressure drop in the air circuit 4170 and provides as an output an estimated pressure, Pm, in the patient interface 3000. 5.4.3.1.2 Vent flow [0200] In one form of the present technology, a vent flow calculation algorithm 4314 receives as an input an estimated pressure, Pm, in the patient interface 3000 and estimates a vent flow of air, Qv, from a vent 3400 in a patient interface 3000. 5.4.3.1.3 Leak flow [0201] In one form of the present technology, a leak flow algorithm 4316 receives as an input a total flow, Qt, and a vent flow Qv, and provides as an output a leak flow Ql by calculating an average of Qt-Qv over a period sufficiently long to include several breathing cycles, e.g. about 10 seconds. [0202] In one form, the leak flow algorithm 4316 receives as an input a total flow, Qt, a vent flow Qv, and an estimated pressure, Pm, in the patient interface 3000, and provides as an output a leak flow Ql by calculating a leak conductance, and determining a leak flow Ql to be a function of leak conductance and pressure, Pm. Preferably leak conductance is calculated as the quotient of low pass filtered non-vent flow Qt-Qv, and low pass filtered square root of pressure Pm, where the low pass filter time constant has a value sufficiently long to include several breathing cycles, e.g. about 10 seconds. 5.4.3.1.4 Respiratory flow [0203] In one form of the present technology, a respiratory flow algorithm 4318 receives as an input a total flow, Qt, a vent flow, Qv, and a leak flow, Ql, and estimates a respiratory flow of air, Qr, to the patient, by subtracting the vent flow Qv and the leak flow Ql from the total flow Qt. 5.4.3.2 Therapy Engine Module 4320 [0204] In one form of the present technology, a therapy engine module 4320 receives as inputs one or more of a pressure, Pm, in a patient interface 3000, and a respiratory flow of air to a patient, Qr, and provides as an output, one or more therapy parameters in a therapy parameter determination process 4329. [0205] In one form of the present technology, a therapy parameter is a CPAP treatment pressure Pt. [0206] In one form of the present technology, a therapy parameter is one or more of a level of pressure support, and a target ventilation. 5.4.3.2.1 Phase determination [0207] In one form of the present technology, the PAP device 4000 does not determine phase. [0208] In one form of the present technology, a phase determination algorithm 4321 receives as an input a signal indicative of respiratory flow, Qr, and provides as an output a phase of a breathing cycle of a patient 1000. [0209] In one form, the phase output is a discrete variable with values of either inhalation or exhalation. [0210] In one form, the phase output is a discrete variable with values of one of inhalation, mid-inspiratory pause, and exhalation. [0211] In one form, the phase output is a continuous variable, for example varying from 0 to 1, or 0 to 2Pi. [0212] In one form, the phase output is determined to have a discrete value of inhalation when a respiratory flow Qr has a positive value that exceeds a positive threshold. In one form, a phase is determined to have a discrete value of exhalation when a respiratory flow Qr has a negative value that is more negative than a negative threshold. 5.4.3.2.2 Waveform determination 4322 [0213] In one form of the present technology, a control module 4330 controls a therapy device 4245 to provide an approximately constant positive airway pressure throughout a respiratory cycle of a patient. [0214] In one form of the present technology, a control module 4330 controls a therapy device 4245 to provide positive airway pressure according to a predetermined waveform of pressure vs phase. In one form, the waveform is maintained at an approximately constant level for all values of phase. In one form, the waveform is a square wave, having a higher value for some values of phase, and a lower level for other values of phase. [0215] In one form of the present technology a waveform determination algorithm 4322 receives as an input a value indicative of current patient ventilation, Vent, and provides as an output a waveform of pressure vs. phase. 5.4.3.2.3 Ventilation determination [0216] In one form of the present technology, a ventilation determination algorithm 4323 receives an input a respiratory flow Qr, and determines a measure indicative of patient ventilation, Vent. [0217] In one form ventilation determination algorithm 4323 determines a current value of patient ventilation, Vent, as the half the low-pass filtered absolute value of respiratory flow, Qr. 5.4.3.2.4 Determination of Inspiratory Flow limitation [0218] In one form of the present technology, a processor executes one or more algorithms for the detection of inspiratory flow limitation. [0219] In one form the inspiratory flow limitation algorithm 4324 receives as an input a respiratory flow signal Qr and provides as an output a metric of the extent to which the inspiratory portion of the breath exhibits inspiratory flow limitation. [0220] In one form of the present technology, the inspiratory portion of each breath is identified by a zero-crossing detector. A number of evenly spaced points (for example, sixty-five), representing points in time, are interpolated by an interpolator along the inspiratory flow-time curve for each breath. The curve described by the points is then scaled by a scaler to have unity length (duration/period) and unity area to remove the effects of changing respiratory rate and depth. The scaled breaths are then compared in a comparator with a pre-stored template representing a normal unobstructed breath, similar to the inspiratory portion of the breath shown in Fig. 6a. Breaths deviating by more than a specified threshold (typically 1 scaled unit) at any time during the inspiration from this template, such as those due to coughs, sighs, swallows and hiccups, as determined by a test element, are rejected. For non-rejected data, a moving average of the first such scaled point is calculated by processor for the preceding several inspiratory events. This is repeated over the same inspiratory events for the second such point, and so on. Thus, for example, sixty five scaled data points are generated by a processor, and represent a moving average of the preceding several inspiratory events, e.g. three events. The moving average of continuously updated values of the (e.g. sixty five) points are hereinafter called the "scaled flow", designated as Qs(t). Alternatively, a single inspiratory event can be utilised rather than a moving average. [0221] From the scaled flow, two shape factors relating to the determination of partial obstmction may be calculated. [0222] Shape factor 1 is the ratio of the mean of the middle (e.g. thirty-two) scaled flow points to the mean overall (e.g. sixty-five) scaled flow points. Where this ratio is in excess of unity, the breath will be taken to be normal. Where the ratio is unity or less, the breath will be taken to be obstructed. A ratio of about 1.17 is taken as a threshold between partially obstmcted and unobstructed breathing, and equates to a degree of obstmction that would permit maintenance of adequate oxygenation in a typical user. [0223] Shape factor 2 is calculated as the RMS deviation from unit scaled flow, taken over the middle (e.g. thirty two) points. An RMS deviation of about 0.2 units is taken to be normal. An RMS deviation of zero is taken to be a totally flow-limited breath. The closer the RMS deviation to zero, the breath will be taken to be more flow limited. [0224] Shape factors 1 and 2 may be used as alternatives, or in combination. In other forms of the present technology, the number of sampled points, breaths and middle points may differ from those described above. Furthermore, the threshold values can other than those described. 5.4.3.2.5 Determination of apneas and hypopneas 4325 [0225] In one form of the present technology, a processor executes one or more algorithms for the determination of the presence of apneas and/or hypopneas. [0226] Preferably the one or more algorithms receive as an input a respiratory flow signal Qr and provide as an output a flag that indicates that an apnea or respectively an hypopnea has been detected. [0227] In one form, an apnea will be said to have been detected when a function of respiratory flow Qr falls below a flow threshold for a predetermined period of time. The function may determine a peak flow, a relatively short-term mean flow, or a flow intermediate of relatively short-term mean and peak flow, for example an RMS flow. The flow threshold may be a relatively long-term measure of flow. [0228] In one form, a hypopnea will be said to have been detected when a function of respiratory flow Qr falls below a second flow threshold for a predetermined period of time. The function may determine a peak flow, a relatively short-term mean flow, or a flow intermediate of relatively short-term mean and peak flow, for example an RMS flow. The second flow threshold may be a relatively long-term measure of flow. The second flow threshold is greater than the flow threshold used to detect apneas. 5.4.3.2.6 Determination of snore [0229] In one form of the present technology, a processor executes one or more snore algorithms for the detection of snore. [0230] In one form the snore algorithm 4326 receives as an input a respiratory flow signal Qr and provides as an output a metric of the extent to which snoring is present. [0231] Preferably the algorithm 4326 comprises the step of determining the intensity of the flow signal in the range of 30-300 Hz. Further preferably, algorithm 4326 comprises a step of filtering the respiratory flow signal Qr to reduce background noise, e.g. the sound of airflow in the system from the blower. 5.4.3.2.7 Determination of airway patency [0232] In one form of the present technology, a processor executes one or more algorithms for the determination of airway patency. [0233] In one form, airway patency algorithm 4327 receives as an input a respiratory flow signal Qr, and determines the power of the signal in the frequency range of about 0.75Hz and about 3Ηζ. The presence of a peak in this frequency range is taken to indicate an open airway. The absence of a peak is taken to be an indication of a closed airway. [0234] In one form, the frequency range within which the peak is sought is the frequency of a small forced oscillation in the treatment pressure Pt. In one implementation, the forced oscillation is of frequency 2 Hz with amplitude about 1 cmH20. [0235] In one form, airway patency algorithm 4327 receives as an input a respiratory flow signal Qr, and determines the presence or absence of a cardiogenic signal. The absence of a cardiogenic signal is taken to be an indication of a closed airway. 5.4.3.2.8 Determination of treatment pressure [0236] In one form of the present technology, processor executes one or more algorithms for the determination of a target treatment pressure Pt. [0237] For example, the therapy parameter determination process 4329 receives input such as one of more of the following: i. A measure of respiratory phase; ii. A waveform; iii. A measure of ventilation; iv. A measure of inspiratory flow limitation; ν. A measure of the presence of apnea and/or hypopnea; vi. A measure of the presence of snore; vii. a sleep stage indication; and viii. A measure of the patency of the airway. [0238] This processing may determine the treatment pressure Pt as a function of indices or measures of one or more of flow limitation, apnea, hypopnea, patency, sleep stage and snore and also may optionally rely on a target ventilation from a target ventilation determination process 4328. In one implementation, these measures are determined on a single breath basis, rather than on an aggregation of several previous breaths. 5.4.3.3 Control module 4330 [0239] A control module 4330 in accordance with one aspect of the present technology receives as an input a target treatment pressure Pt, and controls a therapy device 4245 to deliver that pressure. [0240] A control module 4330 in accordance with one aspect of the present technology receives as an input an ΕΡΑΡ pressure and an IPAP pressure, and controls a therapy device 4245 to deliver those respective pressures. 5.4.3.4 Detection of fault conditions 4340 [0241] In one form of the present technology, a processor executes one or more methods for the detection of fault conditions. Preferably the fault conditions detected by the one or more methods includes at least one of the following: • Power failure (no power, or insufficient power) • Transducer fault detection • Failure to detect the presence of a component • Operating parameters outside recommended ranges (e.g. pressure, flow, temperature, Pa02) • Failure of a test alarm to generate a detectable alarm signal. [0242] Upon detection of the fault condition, the corresponding algorithm signals the presence of the fault by one or more of the following: • Initiation of an audible, visual &/or kinetic (e.g. vibrating) alarm • Sending a message to an external device • Fogging of the incident 5.4.3.5 Therapy device 4245 [0243] In a preferred form of the present technology, the therapy device 4245 is under the control of the control module 4330 to deliver therapy to a patient 1000. [0244] Preferably the therapy device 4245 is a positive air pressure device 4140. 5.5 HUMIDIFIER 5000 5.5.1 Humidifier [0245] In one form of the present technology there is provided a humidifier 5000 which may typically include a water reservoir and a heating plate. 5.6 SLEEP STAGE MONITORS [0246] E1G. 7 is a diagram illustrating an example monitoring embodiment. The sensor, processing and display means may be embodied in one unit, shown as monitoring apparatus 100. In some cases, the sensing modality may be totally non-contact, and may operate through the means of transmitting electromagnetic waves towards the subject. The device may be configured to be sensitive to movement within a distance of 1.2m, and avoid detecting movement from more distant objects. This ensures that interference from a second person in the bed or nearby moving objects such as fans is minimised. Thus, the sensor may be processed to further derive respiration signals. However, it will be understood that in some versions of the present technology others sensors, such as those further described herein, may also or alternatively be employed to generate movement and/or respiration signals for the detection of sleep stage. [0247] In one non-contact sensing embodiment the radiation used is in the microwave range, in which the sensor is of the type described in U.S. Patent No. 6,426,716, the entire contents of which are incorporated herein by reference. [0248] In another embodiment, the radiation is in the form of narrow virtual transmit pulses synthesized by differencing long-duration staggered pulse repetition interval (PRI) transmit pulses. Such a sensor is described in U.S. Patent No. 7,952,515, the entire contents of which are incorporated herein by reference. [0249] In the cases where these radio-frequency based sensors are used, they will produce so-called quadrature signals I and Q which represent the detected movement observed from positions 90° apart in the phase space of the transmitter. An advantage of this approach is that it can help determine the direction of movement, and also smooth out the overall sensitivity of the system. [0250] In general, embodiments of the present technology may include a sleep monitoring device or apparatus that may have one or more processors or utilize a processor of another apparatus, such as any of the processors described throughout this specification, to implement particular sleep stage detection methodologies such as with the algorithms/processes described in more detail herein. Thus, the device or apparatus may include integrated chips, a memory and/or other control instruction, data or information storage medium. For example, programmed instmctions encompassing such detection methodologies may be coded on integrated chips in the memory of the device or apparatus to form one or more application specific integrated chips (ASIC). Such instmctions may also or alternatively be loaded as software or firmware using an appropriate data storage medium. Thus, the processes may be embodied in processor control instmctions and data for controlling apparatus to perform the methodologies and may be contained in any appropriate computer or machine readable recording medium of the non-transitory type such as in the form of software for use by a general purpose computer so that the general purpose computer may serve as a specific purpose computer according to any of the methodologies discussed herein upon loading the software into the general purpose computer. [0251] FIG. 8 shows an example of a process and/or processing means (e.g., one or more processors and/or processing circuits) implemented by the system to generate indicators of sleep stages. The sensor acquires at least one signal 200 which represents the movement of the body. In general, this movement will include components due to breathing effort or cardiac activity, as well as other movements not related to respiratory or cardiac functions. Examples of such general body movements, which throughout this description are referred to as “bodily movement”, include turning over, twitching, adjusting position etc. Signals indicative of these movements could be provided by a radio frequency bio-motion sensor, but could also be acquired by one or more respiratory inductance plethysmography, flow sensors, by pressure sensors embedded in a sensor film or sensor mattress, by a bioimpedance measurement system, by an end-tidal CO2 respiratory monitor, by an ultrasonic sensor, or by an optical sensor. [0252] An initial step of processing may be to determine whether a person is present or absent using the presence-absence detector 201. The means for determining presence or absence can be through measurement of the amplitude of the signal (e.g., the root mean square (RMS) value of the signal) or could involve more complex processing such as determining the spectral content of the signal relative to the expected noise floor of the sensor(s). In one embodiment the processing is performed in a manner as described in International Patent Cooperation Treaty Publication No. WO2007/143535, the entire contents of which are incorporated herein by reference. In another embodiment, periods of movement can be determined by taking the arctangent of the quadrature I and Q signals mentioned above. In this case, the resulting signal will be related directly to the displacement of the object being observed, if normalization and phase unwrapping is correctly carried out. Given the displacement signal, presence-absence can then be determined by seeing if the energy in the displacement signal is greater than a set threshold. [0253] The output of the presence-absence detector stage of processing may be a sequence of epoch labels such as "AAAAPPP", where "A" represents absent and "P" represents present, and an epoch may represent a fixed period of time such as 30 seconds. The signal is then fed to a movement detector 202 which determines whether any movement is present (typically on a shorter time scale such as 1 second). A means for determining movement may be through counting level-crossings of the signal, or by measuring the high frequency content of the signal. The detailed methodology of such measurement is described in International Patent Cooperation Treaty Publication No. WO2007/143535. [0254] Each second can then be associated with movement or non-movement. The outcomes of each 1-second movement detector can be combined into an epoch-based activity counter 203. For example, if an epoch is 30 seconds, and each 1-second period within an epoch has movement, then the overall activity count for that epoch is 30. The amplitude of the movement detected can also be included in the activity count metric. Based on the activity count, a sleep wake determination means 204 assigns labels based on the level of the activity count (for example, an activity count greater than 20 may be considered as a wake epoch). The activity counts of surrounding epochs may also be considered in making this determination. The post-processing rules assessor 205 can be further used to enhance the accuracy of the sleep/wake determination, by for example, removing single isolated epochs of SLEEP surrounded by WAKE. The overall output of the post-processing mles can be a sequence of labels (which can combine the information from the presence/absence detector) and may look like; "AAAAWWWWWSSSSSS", where "A" represents absent, "W" represents wake, and "S" represents sleep. [0255] In parallel to determining the sleep/wake status, further processing is implemented to determine the sleep stage. The respiration analysis block 206 enhances the respiration signal, for example, by filtering the raw input signal from the movement detector 202 with a low pass filter. Using the information from the movement detector 202, the respiration analysis may also label certain sections of signal as unreliable for respiration rate estimation. For example, if the signal is determined to contain indications of large movements, the signal may be so marked so it may be avoided in respiration rate estimate calculations. The respiration rate calculator 207 is used to determine the breathing rate of the person, for example, in breaths/minute or in Hz. The respiration rate can be calculated with a power spectral density estimate, or with an auto-regressive model of the signal. The detailed methodology of such a calculation is described in International Patent Publication No. WO2007/143535. The calculation provides estimates of the respiration rate, for example, on a per-epoch basis, or alternatively on a shorter time scale (e.g., once/second). These respiration rates are provided to the sleep stage determination means 208 which may use the respiration rates to determine sleep stage. For example, in one embodiment, the respiration rate is used to distinguish deep sleep (Stage Ν3) from all other stages of sleep (NI, Ν2 and REM). The relative amplitude of respiration can also be determined and used in the sleep stage determination. [0256] For explanatory purposes, FIG. 9 illustrates an example output of the respiration rate calculation 207 from Fig. 8. In this, it is shown how the signal can be considered in epochs (30 seconds in this case) and how each epoch may have a single respiration rate associated with it. For example, each respiration rate is the rate associated with the maximum power spectral density of the epoch. The epochs may be identified sequentially such as with a suitable label e.g., Epoch N, N+l, etc. In the illustration, Epoch N-5 has a rate of 15 breaths/minute, N-4 has a rate of 14.5 breaths/min, etc. Also, as an illustrative point, the respiration analysis block 206 has determined that Epoch N-l has a sufficiently large movement so that it cannot supply a reliable respiration rate. In such cases, the epoch rate might be identified suitably such as with a label representing that it is “Unavailable” or “Not a Number” etc.. [0257] FIG. 10 shows in more detail a specific embodiment of a processing methodology for sleep stage determination means 208 from FIG. 8. The general principle of operation is to determine a sequence of epochs where the respiration rate is sufficiently stable. The set of SLEEP/WAKE labels for an entire recording is input to the process algorithm. The processing may be initiated by assigning (at 301) the variable “CURRENT EPOCH” to be the first epoch in the series. [0258] The processing then decides at 302 whether the CURRENT_EPOCH has a high amplitude signal (representing good signal quality). If the signal quality is good, then the algorithm can be very confident in the estimate of respiration rate. Thus, the signal quality may be evaluated for the setting of a stability threshold to guage breathing rate variability. In this embodiment, an average signal amplitude of, for example, >40 mV (at 302, 303, 304) is indicative of a high quality signal, and in this case the threshold of, for example, 0.5 breaths/minute, may be set. For situations where the signal is lower in quality the threshold may be set to a more tolerant limit, such as for example, 1.5 breaths/minute, for the allowed respiration rate variability. Such a process (at 302) may employ a root means square (RMS) analysis of the current epoch. [0259] The process then calculates and evaluates (at 305-308) a respiration rate range. For example, the respiration rate range may be determined by finding the minimum and maximum value of all the epochs’ respiration rates between the CURRENT_EPOCH and the last epoch identified (e.g., labelled) as LIGHT_SLEEP. For example, if the last FIGHT_SFEEP was epoch N-6 with a rate of 14.2 ΒΡΜ, and the epochs [Ν-5, Ν-4, ..., N] had rates = [14.4, 14.8, 15.1, 14.9, 14.7, 14.6], then the breathing rate range is (15.1-14.4)=0.7 breaths/minute. If this BREATHING_RATE_RANGE is less than the stability threshold, then the current epoch is labelled as deep sleep (at 308) (which may optionally be represented with an "D" label). Alternatively, if the BREATHING_RATE_RANGE is larger than the stability threshold, then the current epoch is labelled as light sleep (at 307) (which may optionally be represented with an "L" label). Since very short sequences of DEEP_SLEEP are relatively uncommon, the algorithm also excludes (at 309, 310) cases where there is a mn of four or less deep sleep epochs. This is done by checking the current sequence length of the DEEP_SLEEP prior epochs when a LIGHT_SLEEP epoch is encountered. If there are four or less preceding epochs of DEEP_SLEEP encountered since the last LIGHT_SLEEP epoch, these epoch labels are converted (at 310) to LIGHT_SLEEP. Since this condition makes it impossible to finish with DEEP_SLEEP count of less than 5, in such a case by default the algorithm accepts (at 311-313) the WAKE or SLEEP labels for the last four epochs (with SLEEP automatically treated as LIGHT_SLEEP). [0260] As a further optional refinement of the embodiment described above, the stability threshold for “stable breathing” can be refined on a per-subject basis. For example, the default analysis may use a stability threshold of 0.5 breaths/minute, but if this threshold produces physiologically unreasonable values for deep sleep duration (e.g., > 40% or less < 5%), the threshold could be adaptively modified to a more suitable value. [0261] An alternative embodiment that determines sleep stage based on respiration rate variability and amplitude is shown in FIG. 11. This process is based on the observation that the variability of the respiration rate and amplitude can serve to distinguish REM sleep. A period of relatively high variation of the breathing rate is considered as an indication of a REM sleep period. A period of relatively low variation of the breathing rate is considered to be associated with a state of deep sleep. One embodiment for assessing the variability of a time series is the approximate entropy. The approximate entropy assumes lower values for predictable time-series, and higher values as the time-sequence becomes more variable. In this embodiment, the signal 200 (e.g., raw movement signal) is input to a respiration analysis block 501. This respiration analysis block outputs a continuous respiration rate and respiration amplitude estimate (sample graphs of the outputs are illustrated in FIG. 12), e.g., on a 1-second timescale. [0262] The respiration rate is then input into two processing blocks (at 502, 503) in segments (typically of duration 5 minutes, e.g., 300 samples of the respiration rate will be passed into the blocks labelled “Approximate Entropy Block” 502 and the “Power Spectral Density” 503). The approximate entropy is a known technique that assesses the predictability of a signal (i.e., variability) and is described, for example, in http : /7en. wikipedia. org/wiki/Approximate entropy. The block will output a single number for each 5 minute epoch entered, which is the approximate entropy of that section of the signal. For example, the approximate entropy of five-minute segments of respiration rate can be calculated at 502, for example, using parameters of m=2 and m=3 for the embedding dimensions, and a value of r equal to 0.2. The power spectral density (PSD) processing block 503 will estimate the power spectral density of the respiration rate, such as by implementing a suitable technique (e.g., Welch’s averaged periodogram, see http : /7 en. wikipedia. or g/ wiki/W elch’ s method ). The PSD estimate at 503 may generate three measurements: the slope of the PSD, the normalised high frequency power of the respiration rate variability and the low-frequency power of the respiration rate variability. The respiration amplitude signal may also be input to a power spectral density processing block (e.g., at 503) and will output a Low Frequency (LF) power estimate. The values calculated from the processing blocks (at 502,503 and 504) will be input to a classifier. The classifier may then combine them to produce a number which is then used to estimate a sleep stage as Deep, Light Sleep or REM. For example, number may be internal to the classifier (e.g., generated by it) and may be a discriminant value. In some cases, a combination of values within the classifier may be done in a linear fashion. For example, the discriminant value may be a linear weighted combination of the values output from blocks 502-504. In some cases, the value generated by the classifier may be a more complex non-linear combination (such as a value derived by combining the squared values of the values output from 502-504). The classifier may then generate a suitable Sleep Fabel (e.g., drawn from Ν1,Ν2,Ν3, REM or W) therefrom. [0263] In some cases, detrended fluctuation analysis may be implemented to evaluate the short-term and long-term correlations of the respiration rate. Such a processing block may serve as an alternate to the power spectral density processing of the respiration rate that may also be implemented to capture the short-term and long-term correlations . Processing by detrended fluctuation analysis may be implemented by the methodology described in “Establishing the relation between detrended fluctuation analysis and power spectral density analysis for stochastic processes,” Phys Rev Ε Stat Phys Plasmas Fluids Relat Interdiscip Topics. 2000 Νον;62(5 Pt Α):6103-10, by Heneghan and McDarby. [0264] FIG. 12 illustrates an example of the respiration rate signal and the normalized respiration amplitude signals that may be generated by the respiration analysis processing block of FIG. 11. The respiration rate signal is shown in the top graph of FIG. 12. The missing periods (discontinuity) of the signal indicate that the signal quality was insufficient during the discontinuity for a reliable respiration rate estimate. The normalized respiration amplitude signal is illustrated in the bottom graph of FIG 12. It also has discontinuity periods in the signal indicating where the signal quality is insufficient for a reliable respiration amplitude estimate. In some versions, the respiration rate amplitude signal may be obtained by filtering the raw signal 200 into a respiration rate range signal and then applying a Hilbert transform. Alternatively, it may be taken from the amplitude of the peak in respiration rate estimation such as with peak detection and/or envelope detection processing techniques. [0265] FIG. 13 illustrates some of the intermediate processing previously described with reference to the processing components of FIG. 11. In the upper graph of FIG. 13, a power spectral density estimate of a segment of 5-minutes of respiration rate is plotted on a log-log plot. In block 502, data of the respiration rate signal may be processed to fit a line thereto (illustrated as the line labelled "FA" in the upper graph of FIG. 13) for detecting the slope, and the slope data of this fitted line is then output from the processing block. This is based on physiological observations of the long-term and short term control of respiration variability (see Rostig S; Kantelhardt JW; Penzel T et al. “Nonrandom variability of respiration during sleep in healthy humans.” SLEEP 2005;28(4):411-17.) In the lower graph of FIG 13, the power spectral density of five minutes of respiration rate is illustrated on a semi-log scale. Power is represented at different frequencies. The “HIGH FREQUENCY" (labelled as "HF") power of the respiration rate variability may be determined with the integral of the PSD from 0.1 to 0.5 Hz. This may be normalised by dividing by the entire power of the signal. The “LOW-FREQUENCY" (shown as "LF") power may be defined as the power between 0 and 0.1 Hz. [0266] A schematic representation of a scaled version of the numbered output (e.g., discriminant value) of the classifier block 505 of FIG. 11 is shown in Fig. 14. The smoother uninterrupted line represents a scaled version of the numbered output (labelled as "NO"). The breathing rate (labelled as "BR") is visualised by the more variable line in the image. A threshold value (labelled as "THLD") may be compared with the numbered output for classifying the sleep during a specific period. An example of such a value is illustrated by the straight horizontal line crossing the breathing rate axis slightly below the value of 13 breaths per minute. If the classifier block numbered output for the period is above the predetermined threshold value, the respective period may be classified as a REM sleep period. Alternatively, if the classifier block output for the period is below the predetermined threshold value, the respective period may be classified as period of deep sleep. This may be an alternative way of classifying a period as a deep sleep to that described with reference to FIG. 10 but may optionally also serve as an additional/combined test therewith for detecting REM and/or deep sleep. [0267] FIG. 15 illustrates a display of the time course of the sleep stages to a user, which may optionally employ color-coded or shaded bars (e.g., vertical). In the example, bars extending above the main axis (representing time) may be taken as an indication of a state of wake. Bars extending below the axis may be taken as an indication of a sleep state. The amplitude of the bars may correspond to the stage of sleep. For example, the shortest bars may be taken as indicating light sleep, the medium length bars may be taken as indicating deep sleep and the longest bars may be taken as indicating a REM sleep. [0268] FIG. 16 illustrates further processes of another example sleep stage monitoring apparatus 100 of the present technology. In this example, a sensor 1601 or sensors, such as the sensors previously described and including a non-contact sensor, generate(s) a plurality of signals. For example, the sensor of a monitor device (e.g., bed side device or respiratory treatment device) may produce four signals corresponding to a user proximate to the sensor. In the example, two signals may be representative of user motion and two may be representative of user breathing. Data thereof may be generated from each of the four signal channels by sampling (e.g., at 64Hz or other suitable sampling rate.) [0269] The data signals of the sensor may then be input for processing by a window and channel selector 1602. In this processing, each of the breathing channels may be analysed for inband breathing power. Thus, the selector will determine for each channel inband breathing power. The selector will then select the channel with the greatest inband breathing power such as the greatest inband power for a particular epoch (e.g., 30 seconds or other preset length). The selector will then output a window of three epochs (e.g., 30 seconds each) from the selected channel with the window centered on the particular epoch chosen by the selector as a result of the assessment of breathing power. In one example, the inband breathing power assessment may be implemented by spectral analysis processing of each epoch at one or more frequencies attributable to respiration. [0270] The windowed data from the selector may then be input for processing by a wavelet transformer 1604. For example, a discrete wavelet transform of depth 5 may be performed on the windowed epoch data. A suitable filter bank for this process may be chosen. For example, the Biorthogonal 6.8 (bior6.8) wavelet may be implemented. Such a filter bank can be chosen such that the associated wavelet approximates a breath cycle. In such a case, the filters associated with the filter bank may be symmetrical (and so are linear phase). The analysis and synthesis filters may be approximately the same length and are long enough to ensure the wavelet coefficients are smoothened out in the wavelet domain. A hardware implementation of such an algorithm/processing method is well understood. Another suitable wavelet filter bank may be any one typically implemented with fingerprint compression. [0271] The transformed data output from the wavelet processing may then be input for processing by a wavelet details extractor 1606. In this process, the wavelet details coefficients are extracted and reconstructed at the highest levels of the wavelet transform. These details can reveal what parts of the three epoch window (e.g., 90 second period) have high energy. Such high energy may be associated with parts of the signal that could have a lot of motion noise in them. [0272] The extracted details coefficients are then input to a mask constructor 1608. In this process, a binary mask is constructed using the wavelet details. For example, the root mean square ("RMS") average of the power per sample may be calculated. If the power in any sample is significantly greater than the average power per sample over that windowed interval (e.g., 90 second interval) then that part of the binary mask is set to zero (0) otherwise the mask value for that sample is set to one (1). Lone or isolated ones (e.g., 010) and zeros (e.g., 101) are then smoothened out from the mask by inverting them. [0273] This binary mask then serves as a map for determining which parts of the signal should be analysed versus which are the parts of the signal that contain a lot of noise. [0274] The transformed data output from the wavelet processing may also be input for processing by a wavelet de-noiser 1610. This processes the transformed data to de-noise the signal. For example, the process may threshold the wavelet coefficients across all levels of wavelet decomposition and then reconstmct the signal. In one such version, a global thresholding mechanism may be implemented which is designed around a percentage of the power of the windowed signal. [0275] The binary mask and de-noised signal are then input to a mask signal applier 1612. In the processing of the mask signal applier, the binary signal mask is examined to evaluate the de-noised signal. The evaluation identifies the longest portion of the de-noised signal that is greater than a desired length (e.g., 30 seconds). The identified portion of the de-noised signal is then output for feature extraction. [0276] The de-noised wavelet signal from the de-noiser 1610 and the identified portion of the de-noised wavelet signal from the mask signal applier 1612 are then output to a wavelet feature extractor 1614. The processing of the extractor determines one or more features from the portion of the de-noised wavelet signal. For example, power in the highest wavelet details (e.g., the band just above the breathing band) is calculated. Similarly, power in the approximation coefficients may be calculated. The extracted features are then output to the sleep stage classifier 1622. [0277] The denoised wavelet signal may also be input for processing by a breath analyzer 1615. Such processing may include detection of peaks and zero crossings such as with a peak and crossing detector 1616. For example, the processing of the peak and crossing detector 1616 may include extracting zero crossings of the signal. Additionally, a maximum and minimum for each pair of contiguous zero crossings may be calculated. With extracted data from the peak and crossing detector, the breath analyzer 1615 may further process the input data to extract breath interval and amplitude in an interval and amplitude detector 1618. For example, using the zero crossings and peaks, the breath interval is calculated and amplitude for each breath in the given window. Finally, with the breath interval and amplitude, breath statistics may be determined in a breath statistic calculator 1620. For example, such statistics on the breath interval and amplitude measurements from the given window may include the mean and/or variation. Other suitable breath metrics may also be calculated. Such a metric(s) for the input window can serve as a feature(s) for determining sleep stage of the given epoch (e.g., 30 second). As such, the metrics may be output to the sleep stage classifier 1622. [0278] The sleep stage classifier 1622 thus processes the input features (e.g., wavelet features and breath features) to detect a sleep stage. For example, such a classifier may be a mle based processing system that classifies the input parameters. In some cases, the classifier may include input from a function library 1624 for sleep stage detection. The library may provide signal processing on one or more sensed signals to estimate movement, activity count and respiration rates on an epoch basis such as by using non-wavelet based processing. An example of such processing is described in International Patent Publication No. WO2007/143535 (Heneghan et al), the entire disclosure of which is incorporated herein by reference. [0279] In some cases, the sleep stage classifier 1622 may include a Linear Discriminant Analysis (LDA) system. A mle based system may then identify key discriminating parameters for the LDA. [0280] In some cases, the sleep stage data output from the sleep stage classifier 1622 may be further input to a pattern detector 1628. The pattern detector may process the sleep stage data, such as all of the data for a given night (e.g., a plurality of epochs) to perform pattern and trend analysis. The analysis may serve to remove any clearly errant classifications. For example, such pattern analysis may detect and correct a consecutive three epoch designation of wake, rem and wake (WRW) to remove or reclassify the middle rem epoch. [0281] Generally, the processing steps illustrated by all the elements 1602-1628 in Fig. 16 are implemented in one or more processors that may be located in one or more devices, at least one of which may be a bedside unit, a portable mobile device located in the vicinity of the user or a server located remotely from the user. [0282] Optionally, the final output may be generated as a hypnogram for the four sleep stages of wake, light, deep and REM sleep stages and may be presented to a user on a suitable display. By way of further example, the output may be generated in a chart format as illustrated in FIG. 15. In some cases, an absent state (i.e., no person present) may also be determined by BSP sleep wake library and output by the monitor. GLOSSARY [0283] For the purposes of the present technology disclosure, in certain forms of the present technology, one or more of the following definitions may apply. In other forms of the present technology, alternative definitions may apply. 5.6.1 General [0284] Air: In certain forms of the present technology, air supplied to a patient may be atmospheric air, and in other forms of the present technology atmospheric air may be supplemented with oxygen. [0285] Continuous Positive Airway Pressure (CPAP): CPAP treatment will be taken to mean the application of a supply of air or breathable gas to the entrance to the airways at a pressure that is continuously positive with respect to atmosphere, and preferably approximately constant through a respiratory cycle of a patient. In some forms, the pressure at the entrance to the airways will vary by a few centimeters of water within a single respiratory cycle, for example being higher during inhalation and lower during exhalation. In some forms, the pressure at the entrance to the airways will be slightly higher during exhalation, and slightly lower during inhalation. In some forms, the pressure will vary between different respiratory cycles of the patient, for example being increased in response to detection of indications of partial upper airway obstmction, and decreased in the absence of indications of partial upper airway obstruction. 5.6.2 Aspects of PAP devices [0286] Air circuit: A conduit or tube constructed and arranged in use to deliver a supply of air or breathable gas between a PAP device and a patient interface. In particular, the air circuit may be in fluid connection with the outlet of the pneumatic block and the patient interface. The air circuit may be referred to as air delivery tube. In some cases there may be separate limbs of the circuit for inhalation and exhalation. In other cases a single limb is used. [0287] APAP: Automatic Positive Airway Pressure. Positive airway pressure that is continually adjustable between minimum and maximum limits, depending on the presence or absence of indications of SDB events. [0288] Blower or flow generator: A device that delivers a flow of air at a pressure above ambient pressure. [0289] Controller: A device, or portion of a device that adjusts an output based on an input. For example one form of controller has a variable that is under control- the control variable- that constitutes the input to the device. The output of the device is a function of the current value of the control variable, and a set point for the variable. A servo-ventilator may include a controller that has ventilation as an input, a target ventilation as the set point, and level of pressure support as an output. Other forms of input may be one or more of oxygen saturation (Sa02), partial pressure of carbon dioxide (PCO2), movement, a signal from a photoplethysmogram, and peak flow. The set point of the controller may be one or more of fixed, variable or learned. For example, the set point in a ventilator may be a long term average of the measured ventilation of a patient. Another ventilator may have a ventilation set point that changes with time. A pressure controller may be configured to control a blower or pump to deliver air at a particular pressure. [0290] Therapy: Therapy in the present context may be one or more of positive pressure therapy, oxygen therapy, carbon dioxide therapy, control of dead space, and the administration of a dmg. [0291] Motor: A device for converting electrical energy into rotary movement of a member. In the present context the rotating member is an impeller, which rotates in place around a fixed axis so as to impart a pressure increase to air moving along the axis of rotation. [0292] Positive Airway Pressure (PAP) device: A device for providing a supply of air at positive pressure to the airways. [0293] Transducers: A device for converting one form of energy or signal into another. A transducer may be a sensor or detector for converting mechanical energy (such as movement) into an electrical signal. Examples of transducers include pressure sensors, flow sensors, carbon dioxide (CO2) sensors, oxygen (Ο2) sensors, effort sensors, movement sensors, noise sensors, a plethysmograph, and cameras. [0294] Volute: The casing of the centrifugal pump that receives the air being pumped by the impeller, slowing down the flow rate of air and increasing the pressure. The crosssection of the volute increases in area towards the discharge port. 5.6.3 Aspects of the respiratory cycle [0295] Apnea: Preferably, apnea will be said to have occurred when flow falls below a predetermined threshold for a duration, e.g. 10 seconds. An obstructive apnea will be said to have occurred when, despite patient effort, some obstruction of the airway does not allow air to flow. A central apnea will be said to have occurred when an apnea is detected that is due to a reduction in breathing effort, or the absence of breathing effort. [0296] Breathing rate: The rate of spontaneous respiration of a patient, usually measured in breaths per minute. [0297] Duty cycle: The ratio of inhalation time, Ti to total breath time, Ttot. [0298] Effort (breathing): Preferably breathing effort will be said to be the work done by a spontaneously breathing person attempting to breathe. [0299] Expiratory portion of a breathing cycle: The period from the start of expiratory flow to the start of inspiratory flow. [0300] Flow limitation: Preferably, flow limitation will be taken to be the state of affairs in a patient's respiration where an increase in effort by the patient does not give rise to a corresponding increase in flow. Where flow limitation occurs during an inspiratory portion of the breathing cycle it may be described as inspiratory flow limitation. Where flow limitation occurs during an expiratory portion of the breathing cycle it may be described as expiratory flow limitation. [0301] Types of flow limited inspiratory waveforms: (i) Flattened: Having a rise followed by a relatively flat portion, followed by a fall. (ii) M-shaped: Having two local peaks, one at the leading edge, and one at the trailing edge, and a relatively flat portion between the two peaks. (iii) Chair-shaped: Having a single local peak, the peak being at the leading edge, followed by a relatively flat portion. (iv) Reverse-chair shaped: Having a relatively flat portion followed by single local peak, the peak being at the trailing edge. [0302] Hypopnea: Preferably, a hypopnea will be taken to be a reduction in flow, but not a cessation of flow. In one form, a hypopnea may be said to have occurred when there is a reduction in flow below a threshold for a duration. In one form in adults, the following either of the following may be regarded as being hypopneas: (i) a 30% reduction in patient breathing for at least 10 seconds plus an associated 4% desaturation; or (ii) a reduction in patient breathing (but less than 50%) for at least 10 seconds, with an associated desaturation of at least 3% or an arousal. [0303] Hyperpnea: An increase in flow to a level higher than normal flow?. [0304] Inspiratory portion of a breathing cycle: Preferably the period from the start of inspiratory flow to the start of expiratory flow will be taken to be the inspiratory portion of a breathing cycle. [0305] Patency (airway): The degree of the airway being open, or the extent to which the airway is open. A patent airway is open. Airway patency may be quantified, for example with a value of one (1) being patent, and a value of zero (0), being closed. [0306] Positive End-Expiratory Pressure (PEEP): The pressure above atmosphere in the lungs that exists at the end of expiration. [0307] Peak flow (Qpeak): The maximum value of flow during the inspiratory portion of the respiratory flow waveform. [0308] Respiratory flow, airflow, patient airflow, respiratory airflow (Qr): These synonymous terms may be understood to refer to the PAP device’s estimate of respiratory airflow, as opposed to “true respiratory flow” or “true respiratory airflow”, which is the actual respiratory flow experienced by the patient, usually expressed in litres per minute. [0309] Tidal volume (Vt): The volume of air inhaled or exhaled during normal breathing, when extra effort is not applied. [0310] (inhalation) Time (Τΐ): The duration of the inspiratory portion of the respiratory flow waveform. [0311] (exhalation) Time (Te): The duration of the expiratory portion of the respiratory flow waveform. [0312] (total) Time (Ttot): The total duration between the start of the inspiratory portion of one respiratory flow waveform and the start of the inspiratory portion of the following respiratory flow waveform. [0313] Typical recent ventilation: The value of ventilation around which recent values over some predetermined timescale tend to cluster, that is, a measure of the central tendency of the recent values of ventilation. [0314] Upper airway obstruction (UAO): includes both partial and total upper airway obstruction. This may be associated with a state of flow limitation, in which the level of flow increases only slightly or may even decrease as the pressure difference across the upper airway increases (Starling resistor behaviour). [0315] Ventilation (Vent): A measure of the total amount of gas being exchanged by the patient’s respiratory system, including both inspiratory and expiratory flow, per unit time. When expressed as a volume per minute, this quantity is often referred to as “minute ventilation”. Minute ventilation is sometimes given simply as a volume, understood to be the volume per minute. 5.6.4 PAP device parameters [0316] Flow rate: The instantaneous volume (or mass) of air delivered per unit time. While flow rate and ventilation have the same dimensions of volume or mass per unit time, flow rate is measured over a much shorter period of time. Flow may be nominally positive for the inspiratory portion of a breathing cycle of a patient, and hence negative for the expiratory portion of the breathing cycle of a patient. In some cases, a reference to flow rate will be a reference to a scalar quantity, namely a quantity having magnitude only. In other cases, a reference to flow rate will be a reference to a vector quantity, namely a quantity having both magnitude and direction. Flow will be given the symbol Q. Total flow, Qt, is the flow of air leaving the PAP device. Vent flow, Qv, is the flow of air leaving a vent to allow washout of exhaled gases. Leak flow, Ql, is the flow rate of unintentional leak from a patient interface system. Respiratory flow, Qr, is the flow of air that is received into the patient's respiratory system. [0317] Leak: Preferably, the word leak will be taken to be a flow of air to the ambient. Leak may be intentional, for example to allow for the washout of exhaled CO2. Leak may be unintentional, for example, as the result of an incomplete seal between a mask and a patient's face. [0318] Noise, conducted: (how measured, typical values) [0319] Noise, transmitted: (how measured, typical values) [0320] Pressure: Force per unit area. Pressure may be measured in a range of units, including cmFLO, g-f/cm2, hectopascal. lcmFLO is equal to 1 g-f/cm2 and is approximately 0.98 hectopascal. In this specification, unless otherwise stated, pressure is given in units of cmFLO. For nasal CPAP treatment of OSA, a reference to treatment pressure is a reference to a pressure in the range of about 4-20 cmf^O, or about 4-30 cmf^O. The pressure in the patient interface is given the symbol Pm. [0321] Sound Power. The energy per unit time carried by a sound wave. The sound power is proportional to the square of sound pressure multiplied by the area of the wavefront. Sound power is usually given in decibels SWL, that is, decibels relative to a reference power, normally taken as 10"12 watt. [0322] Sound Pressure: The local deviation from ambient pressure at a given time instant as a result of a sound wave travelling through a medium. Sound power is usually given in decibels SPL, that is, decibels relative to a reference power, normally taken as 20 χ 10"6 pascal (Pa), considered the threshold of human hearing. 5.6.5 Terms for ventilators [0323] Adaptive Servo-Ventilator: A ventilator that has a changeable, rather than fixed target ventilation. The changeable target ventilation may be learned from some characteristic of the patient, for example, a respiratory characteristic of the patient. [0324] Backup rate: A parameter of a ventilator that establishes the minimum respiration rate (typically in number of breaths per minute) that the ventilator will deliver to the patient, if not otherwise triggered. [0325] Cycled: The termination of a ventilator's inspiratory phase. When a ventilator delivers a breath to a spontaneously breathing patient, at the end of the inspiratory portion of the breathing cycle, the ventilator is said to be cycled to stop delivering the breath. [0326] ΕΡΑΡ (or ΕΕΡ): a base pressure, to which a pressure varying within the breath is added to produce the desired mask pressure which the ventilator will attempt to achieve at a given time. [0327] IPAP: desired mask pressure which the ventilator will attempt to achieve during the inspiratory portion of the breath. [0328] Pressure support: A number that is indicative of the increase in pressure during ventilator inspiration over that during ventilator expiration, and generally means the difference in pressure between the maximum value during inspiration and the minimum value during expiration (e.g., PS = IPAP - ΕΡΑΡ). In some contexts pressure support means the difference which the ventilator aims to achieve, rather than what it actually achieves. [0329] Servo-ventilator: A ventilator that measures patient ventilation has a target ventilation, and which adjusts the level of pressure support to bring the patient ventilation towards the target ventilation. [0330] Spontaneous/Timed (S/T) - A mode of a ventilator or other device that attempts to detect the initiation of a breath of a spontaneously breathing patient. If however, the device is unable to detect a breath within a predetermined period of time, the device will automatically initiate delivery of the breath. [0331] Swing: Equivalent term to pressure support. [0332] Triggered: When a ventilator delivers a breath of air to a spontaneously breathing patient, it is said to be triggered to do so at the initiation of the respiratory portion of the breathing cycle by the patient's efforts. [0333] Ventilator: A mechanical device that provides pressure support to a patient to perform some or all of the work of breathing. 5.6.6 Anatomy of the respiratory system [0334] Diaphragm: A sheet of muscle that extends across the bottom of the rib cage. The diaphragm separates the thoracic cavity, containing the heart, lungs and ribs, from the abdominal cavity. As the diaphragm contracts the volume of the thoracic cavity increases and air is drawn into the lungs. [0335] Larynx: The larynx, or voice box houses the vocal folds and connects the inferior part of the pharynx (hypopharynx) with the trachea. [0336] Lungs: The organs of respiration in humans. The conducting zone of the lungs contains the trachea, the bronchi, the bronchioles, and the terminal bronchioles. The respiratory zone contains the respiratory bronchioles, the alveolar ducts, and the alveoli. [0337] Nasal cavity: The nasal cavity (or nasal fossa) is a large air filled space above and behind the nose in the middle of the face. The nasal cavity is divided in two by a vertical fin called the nasal septum. On the sides of the nasal cavity are three horizontal outgrowths called nasal conchae (singular "concha") or turbinates. To the front of the nasal cavity is the nose, while the back blends, via the choanae, into the nasopharynx. [0338] Pharynx: The part of the throat situated immediately inferior to (below) the nasal cavity, and superior to the oesophagus and larynx. The pharynx is conventionally divided into three sections: the nasopharynx (epipharynx) (the nasal part of the pharynx), the oropharynx (mesopharynx) (the oral part of the pharynx), and the laryngopharynx (hypopharynx). 5.7 OTHER REMARKS [0339] A portion of the disclosure of this patent document contains material which is subject to copyright protection. The copyright owner has no objection to the facsimile reproduction by anyone of the patent document or the patent disclosure, as it appears in the Patent and Trademark Office patent file or records, but otherwise reserves all copyright rights whatsoever. [0340] Unless the context clearly dictates otherwise and where a range of values is provided, it is understood that each intervening value, to the tenth of the unit of the lower limit, between the upper and lower limit of that range, and any other stated or intervening value in that stated range is encompassed within the technology. The upper and lower limits of these intervening ranges, which may be independently included in the intervening ranges, are also encompassed within the technology, subject to any specifically excluded limit in the stated range. Where the stated range includes one or both of the limits, ranges excluding either or both of those included limits are also included in the technology. [0341] Furthermore, where a value or values are stated herein as being implemented as part of the technology, it is understood that such values may be approximated, unless otherwise stated, and such values may be utilized to any suitable significant digit to the extent that a practical technical implementation may permit or require it. [0342] Unless defined otherwise, all technical and scientific terms used herein have the same meaning as commonly understood by one of ordinary skill in the art to which this technology belongs. Although any methods and materials similar or equivalent to those described herein can also be used in the practice or testing of the present technology, a limited number of the exemplary methods and materials are described herein. [0343] When a particular material is identified as being preferably used to constmct a component, obvious alternative materials with similar properties may be used as a substitute. Furthermore, unless specified to the contrary, any and all components herein described are understood to be capable of being manufactured and, as such, may be manufactured together or separately. [0344] It must be noted that as used herein and in the appended claims, the singular forms "a", "an", and "the" include their plural equivalents, unless the context clearly dictates otherwise. [0345] All publications mentioned herein are incorporated by reference to disclose and describe the methods and/or materials which are the subject of those publications. The publications discussed herein are provided solely for their disclosure prior to the filing date of the present application. Nothing herein is to be construed as an admission that the present technology is not entitled to antedate such publication by virtue of prior invention. Further, the dates of publication provided may be different from the actual publication dates, which may need to be independently confirmed. [0346] Moreover, in interpreting the disclosure, all terms should be interpreted in the broadest reasonable manner consistent with the context. In particular, the terms "comprises" and "comprising" should be interpreted as referring to elements, components, or steps in a non-exclusive manner, indicating that the referenced elements, components, or steps may be present, or utilized, or combined with other elements, components, or steps that are not expressly referenced. [0347] The subject headings used in the detailed description are included only for the ease of reference of the reader and should not be used to limit the subject matter found throughout the disclosure or the claims. The subject headings should not be used in constming the scope of the claims or the claim limitations. [0348] Although the technology herein has been described with reference to particular embodiments, it is to be understood that these embodiments are merely illustrative of the principles and applications of the technology. In some instances, the terminology and symbols may imply specific details that are not required to practice the technology. For example, although the terms "first" and "second" may be used, unless otherwise specified, they are not intended to indicate any order but may be utilised to distinguish between distinct elements. Furthermore, although process steps in the methodologies may be described or illustrated in an order, such an ordering is not required. Those skilled in the art will recognize that such ordering may be modified and/or aspects thereof may be conducted concurrently or even synchronously. [0349] It is therefore to be understood that numerous modifications may be made to the illustrative embodiments and that other arrangements may be devised without departing from the spirit and scope of the technology. 1. A method for classifying sleep stages of a subject, the method comprising using a processor to:access one or more detected signals related to respiration movements of the subject;analyze at least a portion of the detected signals to calculate respiration variability, the respiration variability comprising one or more of variability of respiration rate and variability of respiration amplitude; anddetermine sleep stage based on the respiration variability. 2. The method of claim 1, wherein the method includes further analyzing non-respiratory movements of the subject to classify the sleep stages. 3. The method of claim 1 or 2, further comprising:detecting one or more signals related to respiratory movements of the subject, non-respiratory movements of the subject, or both, using one or more sensors. 4. The method of any one of claims 1 to 3, wherein a detection of at least one of the one or more signals is performed in a non-contact manner. 5. The method of any one of claims 1 to 4, wherein the method further comprises accessing a detected signal related to bodily movement of the subject and combining the respiration variability with the bodily movement to determine the sleep stage. 6. The method of any one of claims 1 to 5 wherein the determination comprises identifying an epoch of deep sleep to distinguish it from other epochs of sleep or wake. 7. The method of any one of claims 1 to 6, the method comprising with a processor, detecting presence or absence of a person. 8. The method of any one of claims 1 to 7, wherein the determination comprises a sleep staging calculation in which its sleep stage outputs are sleep or awake only. 9. The method of any one of claims 1 to 8, wherein the detected signals are processed to estimate a respiratory rate of the subject or a respiratory amplitude of the subject. 10. The method of any one of claims 1 to 9, wherein the detected signals are processed to estimate a respiratory rate and a respiratory amplitude of the subject. 11. The method of any one of claims 1 to 10, wherein an estimate of respiratory rate is made on an epoch basis. 12. The method of any one of claims 1 to 11, wherein the analysis includes setting a respiration stability threshold value depending on a comparison of the variability in amplitude of a measured respiratory signal with an amplitude threshold value. 13. The method of any one of claims 1 to 12, wherein the analysis includes setting a respiration rate stability threshold value depending on a comparison of the variability of a measured respiratory rate signal with a threshold value. 14. The method of any one of claims 1 to 13, wherein the analysis comprises calculating a respiration rate range for each of a number of epochs, based on minimum and maximum values of the respiration rates of each of the respective epochs. 15. The method of claim 14 further comprising:comparing the calculated respiration range with a chosen stability threshold value for the epoch; andclassifying the epoch as a deep sleep if the calculated respiration range is smaller than a set stability threshold, or otherwise classifying the epoch as light sleep. 16. The method of claim 15 further comprising with a processor counting, when a light sleep epoch is encountered, a sequence length of prior deep sleep epochs and, if a number of preceding epochs of deep sleep epochs encountered since a last light sleep epoch is less than a predetermined number, reclassifying these epochs as light sleep. 17. The method of claim 16, wherein the predetermined number is five. 18. The method of any one of claims 1 to 17, wherein the method comprises classifying periods of sleep as either deep sleep or REM sleep on a basis of the variability of the breathing rate during the period. 19. The method of any one of claims 1 to 18, wherein the method includes classifying a period as either a deep sleep or a REM sleep period, based on whether a combination of features derived from spectral analysis and approximate entropy analysis for the period is smaller or larger, respectively, than a threshold value. 20. The method of any one of claims 1 to 19, wherein non-contact radio-frequency-based sensors are used, and the analysis provides quadrature signals I and Q which represent detected movement observed from positions 90° apart in a phase space of a transmitter. 21. The method of any one of claims 1 to 20, wherein the analysis uses respiration rate variability and respiration amplitude variability to determine sleep stage. 22. The method of claim 21, wherein the analysis uses variability of the respiration rate and amplitude to distinguish REM sleep, in which a period of relatively high variation of the breathing rate is considered as an indication of an REM sleep period, and a period of relatively low variation of the breathing rate is considered to be associated with a state of deep sleep. 23. The method of either claim 21 or 22, wherein the analysis comprises assessing variability of a time series using approximate entropy, which assumes lower values for predictable time to series, and higher values as the time to sequence becomes more variable. 24. The method of claim 22, wherein the analysis provides a continuous respiration rate and respiration amplitude estimate, and the respiration rate is then fed into two processing blocks in segments, in which a block will output a single number for an epoch which is an approximate entropy of that segment of the signal. 25. The method of any one of claims 1 to 24 further comprising controlling, with a processor, a detection of the one or more signals related to bodily movement and respiration movements of the subject with a sensor. 26. The method of any one of claims 1 to 25 further comprising controlling, with a processor, a respiratory treatment based on the determined sleep stage. 27. A system for classifying sleep stages of a subject, the system comprising:one or more sensors configured to detect one or more signals which relate to bodily movement and respiration related movements; anda processor configured to analyze at least a portion of the detected signals to calculate respiration variability, the respiration variability comprising one or more of variability of respiration rate and variability of respiration amplitude, and to combine the respiration variability with the bodily movement detection to determine sleep stage. 28. The system of claim 27, wherein at least one of the one or more sensors is a non-contact sensor. 29. The system of claim 28, wherein the at least one non-contact sensor is a radio frequency based sensor. 30. The system of claim 29, wherein the at least one non-contact radio sensor is range gated. 31. The system of any one of claims 27 to 30 further comprising a respiratory treatment apparatus, the respiratory treatment apparatus comprising a flow generator adapted to couple with a patient interface and a controller configured to set a treatment operation of the flow generator, the controller in communication with the processor and configured to control a treatment pressure based, in part, on the determined sleep stage. 32. A computer readable medium having processor control instructions encoded thereon for enabling a processor to perform a method of any of claims 1 to 26 when executed with a processor. 33. A method of a processor of an apparatus for classifying sleep stages of a subject comprising:accessing a plurality of signals related to bodily movement and respiration movements of the subject;selecting one of the plurality of signals for processing;processing the selected signal by wavelet transform;generating a mask corresponding to the transformed signal ;extracting features from the transformed signal in accordance with the mask; andclassifying a sleep stage based on the extracted features. 34. The method of claim 33 wherein the processor selects the one of the plurality of signals by detecting a greatest in-band breathing power. 35. The method of any one of claims 33 to 34 further comprising with the processor extracting breath statistics from the transformed signal, and wherein the classifying the sleep stage is further based on the breath statistics. 36. The method of claim 35 wherein the breath statistics further comprises one or more of a mean of breath interval, a mean of breath amplitude, variation of breath interval and variation of breath amplitude. 37. The method of any one of claims 33 to 36 wherein the extracted features comprises one or more of a power in a highest wavelet detail just above a breathing band and a power in approximation coefficients. 38. The method of any one of claims 33 to 34 wherein the generated mask indicates noise for particular portions of the transformed signal. 39. The method of claim 38 wherein the generated mask is a binary map of the transformed signal. 40. The method of any one of claims 33 to 39 wherein the classifying comprises linear discriminant analysis. 41. The method of any one of claims 33 to 40 further comprising detecting a pattern of classified sleep stages and correcting an errant classification based on the detected pattern. 42. The method of any one of claims 33 to 41 further displaying classified sleep stage, the sleep stages comprising a series of one or more of a wake stage, light sleep stage, a deep sleep stage and a rem sleep stage. 43. A system for classifying sleep stages of a subject, the system comprising:one or more sensors configured to detect a plurality of signals which relate to bodily movement and respiration related movements; anda processor, the processor configured to process the plurality of signals, select one of the plurality of signals for processing, process the selected signal by wavelet transform, generate a mask corresponding to the transformed signal, extract features from the transformed signal in accordance with the mask, and classify a sleep stage based on the extracted features. 44. The system of claim 43 wherein at least one of the one or more sensors is a non-contact sensor. 45. The system of claim 44, wherein the at least one non-contact sensor is a radio frequency based sensor. 46. The system of claim 45 wherein the at least one non-contact radio frequency based sensor is range gated. 47. The system of any one of claims 43 to 46 further comprising a respiratory treatment apparatus, the respiratory treatment apparatus comprising a flow generator adapted to couple with a patient interface and a controller configured to set an treatment operation of the flow generator, the controller in communication with the processor and configured to control a treatment pressure based, in part, on the determined sleep stage. 49. A computer readable medium having processor control instructions encoded thereon for enabling a processor to perform a method of any one of claims 33 to 42 when executed with a processor.